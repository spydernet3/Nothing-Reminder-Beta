<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Nothing Reminder</title>
    <link rel="icon" type="image/png" href="assets/icon.png" />
    <link rel="icon" type="image/png" href="assets/icon.png" />
    <link rel="manifest" href="manifest.json">
    <style>
            :root {
              --bg: #ffffff;
              --text: #000000;
              --muted: #666;
              --accent: #4CAF50;
            }
            * { box-sizing: border-box; }
            body {
              margin: 0;
              font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica          Neue", Arial;
              background: var(--bg);
              color: var(--text);
            }
            .sidebar {
              width: 220px;
              background: #666;
              color: #fff;
              position: fixed;
              height: 100%;
              left: 0;
              display: flex;
              flex-direction: column;
              padding: 12px;
              gap: 8px;
              transition: left 0s;
            }
            .profile {
              display:flex;
              align-items:center;
              gap:18px;
              margin-bottom:8px;
            }
            .menu-btn, .icon-btn, .add-btn {
              display:block;
              width:100%;
              padding:10px;
              border: none;
              background:#888;
              font-style: Italic;
              color:#fff;
              border-radius:6px;
              cursor:pointer;
              text-align:left;
              font-size:15px;
              transition: left 0s;
            }
            .menu-btn:hover, .icon-btn:hover, .add-btn:hover { background:#aaa; }
            .main {
              margin-left: 220px;
              padding: 20px;
              min-height: 100vh;
              transition: margin-left 0s;
            }
            .page.hidden { display:none; }
            .toggle-btn {
              position: absolute;
              left: 210px; /* Adjusted to show partial icon */
              top: 12px;
              padding:6px 8px;
              border-radius:8px;
              border:none;
              background:#ddd;
              cursor:pointer;
              transition: left 0s;
              z-index: 10;
              width: 20px; /* Make it smaller to show partial icon */
              height: 20px;
              display: flex;
              align-items: center;
              justify-content: center;
            }
            .list { list-style:none; padding:0; margin:0 0 12px 0; }
            .list li {
              display:flex;
              align-items:center;
              justify-content:space-between;
              padding:8px;
              border-radius:6px;
              margin-bottom:8px;
              background: rgba(0,0,0,0.03);
              transition: left 0s;
            }
            .item-left { display:flex; flex-direction:column; gap:4px; }
            .badge { background:#eee; padding:4px 8px; border-radius:12px;
              font-size:12px; }
            .form {
              margin-top: 0;
              padding: 12px;
              border-radius: 8px;
              background: #f5f5f5;
              display: flex;
              flex-direction: column;
              gap: 8px;
              max-width: 520px;
              overflow: hidden;
              transition: max-height 0s ease, padding 0s ease;
              max-height: 0;
              padding-top: 0;
              padding-bottom: 0;
              transition: left 0s;
            }
            .form.visible {
              max-height: 500px;
              padding-top: 12px;
              padding-bottom: 12px;
            }
            .form label {
              display:flex;
              flex-direction:column;
              font-size:13px;
              gap:6px;
              transition: left 0s;
            }
            .form input[type="text"], .form input[type="date"], .form textarea,          .form select {
              padding:8px;
              border-radius:6px;
              border:1px solid #ccc;
              transition: left 0s;
            }
            .form-actions {
              display:flex;
              gap:8px;
              margin-top:6px;
              transition: left 0s;
            }
            .primary {
              background: var(--accent);
              color: #fff;
              border:none;
              padding:8px 12px;
              border-radius:6px;
              cursor:pointer;
            }
            .secondary {
              background:#ddd;
              border:none;
              padding:8px 12px;
              border-radius:6px;
              cursor:pointer;
            }
            .icon-small {
              background:transparent;
              border:none;
              cursor:pointer;
              margin-left:8px;
              font-size:16px;
            }
            .add-area {
              margin-top: 8px;
              max-width: 520px;
            }
            .dark {
              --bg: #121212;
              --text: #f1f1f1;
            }
            .dark .main { background:#151515; color:var(--text); }
            .dark .form { background: #232323; }
            .dark .menu-btn, .dark .icon-btn { background:#333; color:var(--text);       }

            /* Settings panel styles */
            .settings-panel {
              display: none;
              flex-direction: column;
              gap: 8px;
              margin-top: 8px;
            }
            .settings-panel.visible { display: flex; }

            /* Consistent button styling for all sections */
            #showAddFormBtn, #homeRemindersToggle, #showAddNoteBtn, #viewNotesToggle, #homeNotesToggle,
            #homeBudgetsToggle, #homeCheckToggle, #showAddBudgetBtn,#viewbudgetToggle, #showAddCheckBtn,
            #viewCheckToggle, #viewRemindersToggle, #monthlyCalendarToggle,#calculatorToggle, #viewHistoryToggle {
              position: relative;
              user-select: none;
              display: flex;
              justify-content: space-between;
              align-items: center;
              font-weight: 600;
              font-size: 15px;
              cursor: pointer;
              transition: left 0s;
              padding: 10px;
              border: none;
              background: #888;
              color: #fff;
              border-radius: 6px;
              text-align: left;
            }

            #showAddFormBtn:hover, #homeRemindersToggle:hover, #showAddNoteBtn:hover, #viewNotesToggle:hover,
            #homeNotesToggle:hover, #homeBudgetsToggle:hover, #homeCheckToggle:hover, #showAddBudgetBtn:hover,
            #viewbudgetToggle:hover, #showAddCheckBtn:hover,#viewCheckToggle:hover, #viewRemindersToggle:hover {
              background: #aaa;
            }

            #showAddFormBtn.open .arrow, #homeRemindersToggle.open .arrow,#showAddNoteBtn.open .arrow,
            #viewNotesToggle.open .arrow, #homeNotesToggle.open .arrow,#homeBudgetsToggle.open .arrow,
            #homeCheckToggle.open .arrow, #showAddBudgetBtn.open .arrow,#viewbudgetToggle.open .arrow,
            #showAddCheckBtn.open .arrow, #viewCheckToggle.open .arrow,#viewRemindersToggle.open .arrow {
              transform: rotate(180deg);
              transition: left 0s;
            }

            /* Add this to your existing <style> block */
            .calendar-day {
                padding: 8px 4px;
                border: 1px solid #eee;
                height: 40px;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: default;
            }
            .calendar-day.today {
                background: var(--accent);
                color: white;
                font-weight: bold;
                border-radius: 50%;
            }
            .calendar-day.spacer {
                background: transparent;
                border: none;
            }
            .calculator-mode.hidden { display: none; }
            .normal-btn {
                padding: 10px;
                font-size: 16px;
                border: none;
                border-radius: 6px;
                cursor: pointer;
            }
            .normal-btn.primary { background: #e0e0e0; color: #000; }
            .normal-btn.secondary { background: #ccc; color: #000; }

            /* Scrollable lists */
            .scrollable-list {
              max-height: 300px;
              overflow-y: auto;
              border: 1px solid #ccc;
              border-radius: 6px;
              padding: 8px;
              margin-top: 8px;
            }

            /* Scrollbar styling */
            .scrollable-list::-webkit-scrollbar {
              width: 8px;
              border-radius: 4px;
            }

            .scrollable-list::-webkit-scrollbar-track {
              background: #f1f1f1;
              border-radius: 4px;
            }

            .scrollable-list::-webkit-scrollbar-thumb {
              background: #888;
              border-radius: 4px;
            }

            .scrollable-list::-webkit-scrollbar-thumb:hover {
              background: #555;
              border-radius: 4px;
            }

            /* Checklist status button */
            .status-btn {
              background: #007bff;
              color: white;
              border: none;
              padding: 4px 8px;
              border-radius: 4px;
              cursor: pointer;
              margin-right: 8px;
              font-size: 12px;
            }

            /* Branding footer */
            .branding-footer {
              position: fixed;
              bottom: 10px;
              left: 50%;
              transform: translateX(-50%);
              font-size: 12px;
              color: #666;
              text-align: center;
            }

            .branding-footer a {
              color: #666;
              text-decoration: none;
            }

            /* Notification Page Specific Styles */
            .notif-status-box {
              padding: 15px;
              border-radius: 8px;
              margin-bottom: 20px;
              background: #e0f7fa;
              border: 1px solid #b2ebf2;
            }
            .notif-status-box.denied {
              background: #ffebee;
              border: 1px solid #ffcdd2;
            }
            .notif-setting-item {
              display: flex;
              justify-content: space-between;
              align-items: center;
              padding: 10px 0;
              border-bottom: 1px solid #eee;
            }
            .notif-setting-item:last-child {
              border-bottom: none;
            }
            .toggle-switch {
              position: relative;
              display: inline-block;
              width: 50px;
              height: 24px;
            }
            .toggle-switch input {
              opacity: 0;
              width: 0;
              height: 0;
            }
            .slider {
              position: absolute;
              cursor: pointer;
              top: 0;
              left: 0;
              right: 0;
              bottom: 0;
              background-color: #ccc;
              transition: 0.4s;
              border-radius: 24px;
            }
            .slider:before {
              position: absolute;
              content: "";
              height: 16px;
              width: 16px;
              left: 4px;
              bottom: 4px;
              background-color: white;
              transition: 0.4s;
              border-radius: 50%;
            }
            input:checked + .slider {
              background-color: var(--accent);
            }
            input:checked + .slider:before {
              transform: translateX(26px);
            }
    </style>
  </head>
  <body>
    <div id="sidebar" class="sidebar">
      <div class="profile">
        <img
          id="profilePhoto"
          src="https://via.placeholder.com/40"
          alt="Profile"
          width="45"
          height="45"
          style="border-radius:50%;object-fit:cover;cursor:pointer;"
          onclick="document.getElementById('photoUpload').click()"
        />
        <h3 id="profileName">üë§ User</h3>
      </div>
      <input
        id="photoUpload"
        type="file"
        accept="image/*"
        style="display:none;"
      />

      <button class="menu-btn" data-page="home">üè† Home</button>
      <button class="menu-btn" data-page="reminders">‚è∞ Reminders</button>
      <button class="menu-btn" data-page="notes">üìù Notes</button>
      <button class="menu-btn" data-page="budget">üí∞ Budget Tracker</button>
      <button class="menu-btn" data-page="Check">‚úí Check List</button>
      <button class="menu-btn" data-page="utilities">üõ†Ô∏è Utilities</button>
      <button class="menu-btn" data-page="other">üé≤ Other Apps</button>

      <div id="settingsContainer" style="margin-top:auto;">
        <button id="settingsBtn" class="icon-btn" aria-expanded="false">
          ‚öôÔ∏è Settings ‚ñº
        </button>
        <div id="settingsPanel" class="settings-panel" aria-hidden="true">
          <button class="menu-btn" id="editNameBtn">‚úèÔ∏è Edit Name</button>
          <button class="icon-btn" id="darkModeBtn">üåô Dark Mode</button>

          <button
            class="menu-btn"
            data-page="notifications"
            id="notificationBtn"
          >
            üîî Notification Settings
          </button>

          <button class="menu-btn" data-page="terms">
            üí¢ Terms & Conditions
          </button>
          <button class="menu-btn" data-page="how">üßë‚Äçüè´ How to Use</button>
        </div>
      </div>
    </div>

    <div id="main" class="main">
      <button id="toggleBtn" class="toggle-btn">‚Æû</button>

      <div id="home" class="page">
        <h2>Home</h2>
        <div class="add-area">
          <button
            id="homeRemindersToggle"
            class="add-btn"
            aria-expanded="false"
          >
            ‚ö†Ô∏è REMINDERS <span class="arrow">‚ñº</span>
          </button>
          <div id="homeRemindersContainer" class="form"></div>
        </div>
        <div class="add-area">
          <button id="homeNotesToggle" class="add-btn" aria-expanded="false">
            üìù NOTES <span class="arrow">‚ñº</span>
          </button>
          <div id="homeNotesContainer" class="form" aria-hidden="true"></div>
        </div>
        <div class="add-area">
          <button id="homeBudgetsToggle" class="add-btn" aria-expanded="false">
            üí∞ BUDGET OVERVIEW <span class="arrow">‚ñº</span>
          </button>
          <div id="homeBudgetsContainer" class="form" aria-hidden="true"></div>
        </div>

        <div class="add-area">
          <button id="homeCheckToggle" class="add-btn" aria-expanded="false">
            ‚úí CHECK LIST <span class="arrow">‚ñº</span>
          </button>
          <div id="homeCheckContainer" class="form" aria-hidden="true"></div>
        </div>

        <div class="branding-footer">
          <a href="https://github.com/spydernet3" target="_blank"
            >By Spydernet</a
          >
        </div>
      </div>

      <div id="reminders" class="page hidden">
        <h2>Reminders</h2>
        <div class="add-area">
          <button id="showAddFormBtn" class="add-btn" aria-expanded="false">
            Ôºã ADD NEW REMINDER <span class="arrow">‚ñº</span>
          </button>
          <div id="reminderFormContainer" class="form" aria-hidden="true">
            <label
              >Title<input id="reminderTitle" type="text" placeholder="Title"
            /></label>
            <label>Start date<input id="startDate" type="date" /></label>
            <label>End date<input id="endDate" type="date" /></label>
            <div class="form-actions">
              <button id="saveReminderBtn" class="primary">Save</button>
              <button id="cancelReminderBtn" class="secondary">Cancel</button>
            </div>
          </div>
        </div>
        <div class="add-area">
          <button
            id="viewRemindersToggle"
            class="add-btn"
            aria-expanded="false"
          >
            üëÄ VIEW REMINDERS <span class="arrow">‚ñº</span>
          </button>
          <ul id="reminderList" class="list scrollable-list form"></ul>
        </div>
      </div>

      <div id="notes" class="page hidden">
        <h2>üìù Notes</h2>
        <div class="add-area">
          <button id="showAddNoteBtn" class="add-btn" aria-expanded="false">
            Ôºã ADD NEW NOTE <span class="arrow">‚ñº</span>
          </button>
          <div id="noteFormContainer" class="form" aria-hidden="true">
            <label>
              Attach File
              <input
                id="noteFile"
                type="file"
                accept="image/*,.pdf,.doc,.docx,.mp3,.mp4"
              />
            </label>

            <label>
              Note<textarea
                id="noteText"
                rows="4"
                placeholder="Write your note here..."
              ></textarea>
            </label>

            <label>
              Table Format<input type="checkbox" id="tableFormatCheckbox" />
              <span>Enable table format</span>
            </label>

            <div class="form-actions">
              <button id="saveNoteBtn" class="primary">Save</button>
              <button id="cancelNoteBtn" class="secondary">Cancel</button>
            </div>
          </div>
        </div>
        <div class="add-area">
          <button id="viewNotesToggle" class="add-btn" aria-expanded="false">
            üëÄ VIEW NOTES <span class="arrow">‚ñº</span>
          </button>
          <ul id="noteList" class="list scrollable-list form"></ul>
        </div>
      </div>

      <div id="budget" class="page hidden">
    <h2>üí∞ Budget Tracker</h2>

    <div class="add-area">
        <button id="showAddBudgetBtn" class="add-btn" aria-expanded="false">
            ‚ñ∂ ADD NEW BUDGET
        </button>
        <div id="budgetFormContainer" class="form" aria-hidden="true">
            <label
                >Title<input
                    id="budgetTitle"
                    type="text"
                    placeholder="Budget title"
            /></label>
            <label
                >Total Amount (‚Çπ)<input
                    id="budgetAmount"
                    type="number"
                    placeholder="Total Amount"
            /></label>
            <label>Start Date<input id="budgetStartDate" type="date" /></label>
            <label>End Date<input id="budgetEndDate" type="date" /></label>
            <div class="form-actions">
                <button id="saveBudgetBtn" class="primary">Save</button>
                <button id="cancelBudgetBtn" class="secondary">Cancel</button>
            </div>
        </div>
    </div>

    <div id="budgetExpenseFormContainer" class="form hidden" aria-hidden="true">
        <h4 id="expenseBudgetTitle">Adding expense...</h4> 
        <label
            >Amount (‚Çπ)<input
                id="expenseAmount"
                type="number"
                placeholder="Expense Amount"
        /></label>
        <label
            >Description<input
                id="expenseDescription"
                type="text"
                placeholder="What was this expense for?"
        /></label>
        <div class="form-actions">
            <button id="saveExpenseBtn" class="primary">Record Expense</button>
            <button id="cancelExpenseBtn" class="secondary">Cancel</button>
        </div>
    </div>

    <div class="add-area">
        <button id="viewbudgetToggle" class="add-btn" aria-expanded="false">
            ‚ñ∂ VIEW BUDGETS
        </button>
        <ul id="budgetList" class="list scrollable-list form visible" aria-hidden="false"></ul>
    </div>
</div>
      <div id="Check" class="page hidden">
        <h2>‚úí Check List</h2>
        <div class="add-area">
          <button id="showAddCheckBtn" class="add-btn" aria-expanded="false">
            Ôºã CREATE NEW CHECKLIST <span class="arrow">‚ñº</span>
          </button>
          <div id="checkFormContainer" class="form" aria-hidden="true">
            <label>
              Title<input
                id="checkTitle"
                type="text"
                placeholder="Checklist title"
              />
            </label>
            <label>
              Status<select id="checkStatus">
                <option value="open">Open</option>
                <option value="closed">Closed</option>
              </select>
            </label>
            <label>
              Items (one per line)<textarea
                id="checkItems"
                rows="4"
                placeholder="Item 1&#10;Item 2&#10;Item 3"
              ></textarea>
            </label>
            <div class="form-actions">
              <button id="saveCheckBtn" class="primary">Save</button>
              <button id="cancelCheckBtn" class="secondary">Cancel</button>
            </div>
          </div>
        </div>
        <div class="add-area">
          <button id="viewCheckToggle" class="add-btn" aria-expanded="false">
            üëÄ VIEW CHECKLISTS <span class="arrow">‚ñº</span>
          </button>
          <ul id="checkList" class="list scrollable-list form"></ul>
        </div>
      </div>

      <div id="notifications" class="page hidden">
        <h2>üîî Notification Settings</h2>

        <div id="globalNotifStatus" class="notif-status-box">
          <h3>Browser Permission</h3>
          <p id="browserPermissionText"></p>
          <button
            id="requestPermissionBtn"
            class="primary"
            style="margin-top: 10px;"
          >
            Request / Check Permission
          </button>
        </div>

        <h3>Notification Categories</h3>
        <p style="font-size: 14px; opacity: 0.8;">
          Note: Category notifications only work if the browser permission above
          is # Granted #.
        </p>

        <div class="notif-setting-item">
          <span>‚è∞ Reminder Page Reminders</span>
          <label class="toggle-switch">
            <input type="checkbox" id="toggleReminders" />
            <span class="slider"></span>
          </label>
        </div>

        <div class="notif-setting-item">
          <span>üìù Notes Reminders </span>
          <label class="toggle-switch">
            <input type="checkbox" id="toggleNotes" />
            <span class="slider"></span>
          </label>
        </div>

        <div class="notif-setting-item">
          <span>‚úí Checklist Reminders</span>
          <label class="toggle-switch">
            <input type="checkbox" id="toggleChecklist" />
            <span class="slider"></span>
          </label>
        </div>

        <div class="notif-setting-item">
          <span>üí∞ Budget Reminders</span>
          <label class="toggle-switch">
            <input type="checkbox" id="toggleBudget" />
            <span class="slider"></span>
          </label>
        </div>
      </div>

      <div id="terms" class="page hidden">
        <h1>Privacy Policy!</h1>
        <ul>
          <p>
            App data are stored using local storage. Avoid data losses before
            formatting the device.
          </p>
          <p>Maximum 500MB allowed to store user datas in local storage.</p>
          <p>
            Datas are synced as much as possible while page load after it
            depends on your browser behaviour
          </p>
          <p>
            Import & Export and Sharing datas are not allowed for security
            reasons
          </p>
          <p>
            Codes are carefully reviewed by ChatGPT and other AI Models Checkout
            Overall Rating in GitHub Readme file
          </p>
          <p>
            Would you like to contribute, check out here:
            <a href="https://github.com/spydernet3" target="_blank"
              >Spydernet Github ‚Ü†</a
            >
          </p>
        </ul>
        <hr />
        <h3>Version Info!</h3>
        <ul>
          <p>Version 13.4.7</p>
          <p>Last Updated: 27-Sep-2025</p>
          <p>Project Type: Open source</p>
        </ul>
      </div>

      <div id="how" class="page hidden">
        <h3>Install App</h3>
        <hr />
        <ul>
          <li>By Pressing Add to Home Screen Button There You can see Install App to install page as PWA</li>
          <li>In App Notification logic working here</li>
        </ul>
        <h3>Reminder!</h3>
        <hr />
        <ul>
          <li>Go to the Reminders page</li>
          <li>Click + Add New Reminder</li>
          <li>Fill Title, Start Date, End Date</li>
          <li>Click Save</li>
          <li>Edit or delete using the ‚úèÔ∏è and üóëÔ∏è button.</li>
          <li>
            Today & Tomorrow Due reminders will appeared on the Home page
            automatically.
          </li>
        </ul>

        <h3>Notes!</h3>
        <hr />
        <ul>
          <li>Go to the Notes page.</li>
          <li>Click + Add New Note.</li>
          <li>Write your note in the textarea.</li>
          <li>It supports file formats (Images, pdf, audio, video, docs).</li>
          <li>Click Save. IST date & time are added automatically.</li>
          <li>Edit or delete using the ‚úèÔ∏è and üóëÔ∏è button.</li>
        </ul>

        <h3>Budget Tracker!</h3>
        <hr />
        <ul>
          <li>Go to the Budget Tracker page.</li>
          <li>Click + Add New Budget.</li>
          <li>That will showed Total Amount/Remaining Days</li>
          <li>That will shows Cost per day How much you need to spend</li>
          <li>
            At Budget reminder it reminders your spend limit hole day with 5
            Mins Interval
          </li>
          <li>Edit or delete using the ‚úèÔ∏è and üóëÔ∏è button.</li>
        </ul>

        <h3>Profile!</h3>
        <hr />
        <ul>
          <li>Click the profile picture to upload a new image.</li>
          <li>Click Edit Name to update the username now under Settings.</li>
        </ul>
        <h3>Checklist!</h3>
        <hr />
        <ul>
          <li>Create checklist and set status either Open/Closed</li>
          <li>Opened checklist listed in Home screen</li>
        </ul>
        <h3>Dark Mode!</h3>
        <hr />
        <ul>
          <li>
            Open Settings (‚öôÔ∏è) in the sidebar, then click the üåô button to
            toggle dark mode.
          </li>
          <li>Dark mode preference is saved.</li>
        </ul>
        <h3>Notification!</h3>
        <hr />
        <ul>
          <li>Notification will showed once page is active</li>
          <li>You will Turn Notification On/Off</li>
          <li> When app is active then only Notification showed,Background push Notification's are restricted</li>
          <li>You can customize notification as per your requirements</li>
        </ul>
        <h3>Offline Mode</h3>
        <hr />
        <ul>
          <li>
            Step: Download Source Code Zip File in your Device and Extract foder
            then Open index.html without internet in any broweser.
          </li>
          <li>Note: notifications are not supposed to working</li>
        </ul>
      </div>

      <div id="utilities" class="page hidden">
        <h2>üõ†Ô∏è Utilities</h2>
        <div class="add-area">
          <button
            id="monthlyCalendarToggle"
            class="add-btn"
            aria-expanded="false"
          >
            üìÖ MONTHLY CALENDAR <span class="arrow">‚ñº</span>
          </button>
          <div id="monthlyCalendarContainer" class="form" aria-hidden="true">
            <div
              id="calendarDisplay"
              style="padding: 10px; border: 1px solid #ddd; border-radius: 6px;"
            >
              <div
                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;"
              >
                <button id="prevMonthBtn" class="secondary">‚óÄ</button>
                <h4 id="currentMonthYear"></h4>
                <button id="nextMonthBtn" class="secondary">‚ñ∂</button>
              </div>
              <div
                id="calendarGrid"
                style="display: grid; grid-template-columns: repeat(7, 1fr); text-align: center; font-size: 14px;"
              >
                <div>S</div>
                <div>M</div>
                <div>T</div>
                <div>W</div>
                <div>T</div>
                <div>F</div>
                <div>S</div>
              </div>
            </div>
          </div>
        </div>

        <div class="add-area">
          <button id="calculatorToggle" class="add-btn" aria-expanded="false">
            üßÆ CALCULATOR <span class="arrow">‚ñº</span>
          </button>
          <div id="calculatorContainer" class="form" aria-hidden="true">
            <label>
              Select Mode:
              <select id="calculatorMode">
                <option value="normal">Normal Calculator</option>
                <option value="age">Age Calculator</option>
                <option value="date">Date Difference Calculator</option>
                <option value="scientific" disabled>
                  Scientific Calculator (WIP)
                </option>
              </select>
            </label>
            <div id="normalCalculator" class="calculator-mode">
              <input
                type="text"
                id="normalDisplay"
                value="0"
                readonly
                style="text-align: right; font-size: 20px; margin-bottom: 8px;"
              />
              <div
                style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px;"
              >
                <button
                  class="secondary normal-btn"
                  data-value="clear"
                  style="grid-column: span 2;"
                >
                  C
                </button>
                <button class="secondary normal-btn" data-value="backspace">
                  ‚å´
                </button>
                <button class="secondary normal-btn" data-value="/">/</button>

                <button class="primary normal-btn" data-value="7">7</button>
                <button class="primary normal-btn" data-value="8">8</button>
                <button class="primary normal-btn" data-value="9">9</button>
                <button class="secondary normal-btn" data-value="*">*</button>

                <button class="primary normal-btn" data-value="4">4</button>
                <button class="primary normal-btn" data-value="5">5</button>
                <button class="primary normal-btn" data-value="6">6</button>
                <button class="secondary normal-btn" data-value="-">-</button>

                <button class="primary normal-btn" data-value="1">1</button>
                <button class="primary normal-btn" data-value="2">2</button>
                <button class="primary normal-btn" data-value="3">3</button>
                <button class="secondary normal-btn" data-value="+">+</button>

                <button
                  class="primary normal-btn"
                  data-value="."
                  style="font-weight: bold;"
                >
                  .
                </button>
                <button class="primary normal-btn" data-value="0">0</button>
                <button
                  class="primary normal-btn"
                  data-value="equals"
                  style="grid-column: span 2; background: var(--accent);"
                >
                  = Save & Calc
                </button>
              </div>
            </div>
            <div id="ageCalculator" class="calculator-mode hidden">
              <label>Date of Birth <input type="date" id="dobInput" /></label>
              <label>As of Date <input type="date" id="asOfDateInput" /></label>
              <div class="form-actions">
                <button id="calculateAgeBtn" class="primary">
                  Calculate Age
                </button>
              </div>
              <p id="ageResult" style="margin-top: 10px; font-weight: 600;"></p>
            </div>
            <div id="dateCalculator" class="calculator-mode hidden">
              <label>Start Date <input type="date" id="dateDiffStart" /></label>
              <label>End Date <input type="date" id="dateDiffEnd" /></label>
              <div class="form-actions">
                <button id="calculateDateDiffBtn" class="primary">
                  Calculate Difference
                </button>
              </div>
              <p
                id="dateDiffResult"
                style="margin-top: 10px; font-weight: 600;"
              ></p>
            </div>
          </div>
        </div>
        <div class="add-area">
          <button id="viewHistoryToggle" class="add-btn" aria-expanded="false">
            ‚è≥ VIEW HISTORY <span class="arrow">‚ñº</span>
          </button>
          <ul
            id="calculationHistoryList"
            class="list scrollable-list form"
            aria-hidden="true"
          ></ul>
        </div>
      </div>

      <div id="other" class="page hidden">
        <h2>üé≤ Other Apps</h2>
        <div
          style="display: flex; flex-wrap: wrap; gap: 20px; margin-top: 20px;"
        >
          <a
            href="https://you-tube-seven.vercel.app/"
            target="_blank"
            style="text-decoration: none; color: inherit;"
          >
            <button class="menu-btn" style="width: 180px;">
              YouTube Filter
            </button>
          </a>
          <a
            href="https://spydernet3.github.io/QR-Generator/"
            target="_blank"
            style="text-decoration: none; color: inherit;"
          >
            <button class="menu-btn" style="width: 180px;">QR Generator</button>
          </a>
          <a
            href="https://spydernet3.github.io/multi_website_browser/"
            target="_blank"
            style="text-decoration: none; color: inherit;"
          >
            <button class="menu-btn" style="width: 180px;">
              Multi Website Browser
            </button>
          </a>
          <a
            href="https://spydernet3.github.io/Battery_Health_Monitor/"
            target="_blank"
            style="text-decoration: none; color: inherit;"
          >
            <button class="menu-btn" style="width: 180px;">
              Battery Health Monitor
            </button>
          </a>
          <a
            href="https://spydernet3.github.io/farewell/"
            target="_blank"
            style="text-decoration: none; color: inherit;"
          >
            <button class="menu-btn" style="width: 180px;">
              Farewell Wishes
            </button>
          </a>
          <a
            href="https://spydernet3.github.io/live-audio-transcrib/"
            target="_blank"
            style="text-decoration: none; color: inherit;"
          >
            <button class="menu-btn" style="width: 180px;">Email Alert</button>
          </a>
          <a
            href="https://github.com/spydernet3/Text-messaging-alert"
            target="_blank"
            style="text-decoration: none; color: inherit;"
          >
            <button class="menu-btn" style="width: 180px;">SmS Alert</button>
          </a>
          <a
            href="https://spydernet3.github.io/live-audio-transcrib/"
            target="_blank"
            style="text-decoration: none; color: inherit;"
          >
            <button class="menu-btn" style="width: 180px;">
              Live Audio Transcrib
            </button>
          </a>
          <a
            href="https://spydernet3.github.io/Notepad/"
            target="_blank"
            style="text-decoration: none; color: inherit;"
          >
            <button class="menu-btn" style="width: 180px;">Notepad</button>
          </a>
          <a
            href="https://spydernet3.github.io/Smart-Card/"
            target="_blank"
            style="text-decoration: none; color: inherit;"
          >
            <button class="menu-btn" style="width: 180px;">Smart Card</button>
          </a>
        </div>
      </div>
    </div>
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Nothing Reminder</title>

    <style>
      :root {
        --bg: #ffffff;
        --text: #000000;
        --muted: #666;
        --accent: #4CAF50;
      }
      * { box-sizing: border-box; }
      body {
        margin: 0;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica          Neue", Arial;
        background: var(--bg);
        color: var(--text);
      }
      .sidebar {
        width: 220px;
        background: #666;
        color: #fff;
        position: fixed;
        height: 100%;
        left: 0;
        display: flex;
        flex-direction: column;
        padding: 12px;
        gap: 8px;
        transition: left 0s;
      }
      .profile {
        display:flex;
        align-items:center;
        gap:18px;
        margin-bottom:8px;
      }
      .menu-btn, .icon-btn, .add-btn {
        display:block;
        width:100%;
        padding:10px;
        border: none;
        background:#888;
        font-style: Italic;
        color:#fff;
        border-radius:6px;
        cursor:pointer;
        text-align:left;
        font-size:15px;
        transition: left 0s;
      }
      .menu-btn:hover, .icon-btn:hover, .add-btn:hover { background:#aaa; }
      .main {
        margin-left: 220px;
        padding: 20px;
        min-height: 100vh;
        transition: margin-left 0s;
      }
      .page.hidden { display:none; }
      .toggle-btn {
        position: absolute;
        left: 210px; /* Adjusted to show partial icon */
        top: 12px;
        padding:6px 8px;
        border-radius:8px;
        border:none;
        background:#ddd;
        cursor:pointer;
        transition: left 0s;
        z-index: 10;
        width: 20px; /* Make it smaller to show partial icon */
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .list { list-style:none; padding:0; margin:0 0 12px 0; }
      .list li {
        display:flex;
        align-items:center;
        justify-content:space-between;
        padding:8px;
        border-radius:6px;
        margin-bottom:8px;
        background: rgba(0,0,0,0.03);
        transition: left 0s;
      }
      .item-left { display:flex; flex-direction:column; gap:4px; }
      .badge { background:#eee; padding:4px 8px; border-radius:12px;
        font-size:12px; }
      .form {
        margin-top: 0;
        padding: 12px;
        border-radius: 8px;
        background: #f5f5f5;
        display: flex;
        flex-direction: column;
        gap: 8px;
        max-width: 520px;
        overflow: hidden;
        transition: max-height 0s ease, padding 0s ease;
        max-height: 0;
        padding-top: 0;
        padding-bottom: 0;
        transition: left 0s;
      }
      .form.visible {
        max-height: 500px;
        padding-top: 12px;
        padding-bottom: 12px;
      }
      .form label {
        display:flex;
        flex-direction:column;
        font-size:13px;
        gap:6px;
        transition: left 0s;
      }
      .form input[type="text"], .form input[type="date"], .form textarea,          .form select {
        padding:8px;
        border-radius:6px;
        border:1px solid #ccc;
        transition: left 0s;
      }
      .form-actions {
        display:flex;
        gap:8px;
        margin-top:6px;
        transition: left 0s;
      }
      .primary {
        background: var(--accent);
        color: #fff;
        border:none;
        padding:8px 12px;
        border-radius:6px;
        cursor:pointer;
      }
      .secondary {
        background:#ddd;
        border:none;
        padding:8px 12px;
        border-radius:6px;
        cursor:pointer;
      }
      .icon-small {
        background:transparent;
        border:none;
        cursor:pointer;
        margin-left:8px;
        font-size:16px;
      }
      .add-area {
        margin-top: 8px;
        max-width: 520px;
      }
      .dark {
        --bg: #121212;
        --text: #f1f1f1;
      }
      .dark .main { background:#151515; color:var(--text); }
      .dark .form { background: #232323; }
      .dark .menu-btn, .dark .icon-btn { background:#333; color:var(--text);       }

      /* Settings panel styles */
      .settings-panel {
        display: none;
        flex-direction: column;
        gap: 8px;
        margin-top: 8px;
      }
      .settings-panel.visible { display: flex; }

      /* Consistent button styling for all sections */
      #showAddFormBtn, #homeRemindersToggle, #showAddNoteBtn, #viewNotesToggle, #homeNotesToggle,
      #homeBudgetsToggle, #homeCheckToggle, #showAddBudgetBtn,#viewbudgetToggle, #showAddCheckBtn,
      #viewCheckToggle, #viewRemindersToggle, #monthlyCalendarToggle,#calculatorToggle, #viewHistoryToggle {
        position: relative;
        user-select: none;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: 600;
        font-size: 15px;
        cursor: pointer;
        transition: left 0s;
        padding: 10px;
        border: none;
        background: #888;
        color: #fff;
        border-radius: 6px;
        text-align: left;
      }

      #showAddFormBtn:hover, #homeRemindersToggle:hover, #showAddNoteBtn:hover, #viewNotesToggle:hover,
      #homeNotesToggle:hover, #homeBudgetsToggle:hover, #homeCheckToggle:hover, #showAddBudgetBtn:hover,
      #viewbudgetToggle:hover, #showAddCheckBtn:hover,#viewCheckToggle:hover, #viewRemindersToggle:hover {
        background: #aaa;
      }

      #showAddFormBtn.open .arrow, #homeRemindersToggle.open .arrow,#showAddNoteBtn.open .arrow,
      #viewNotesToggle.open .arrow, #homeNotesToggle.open .arrow,#homeBudgetsToggle.open .arrow,
      #homeCheckToggle.open .arrow, #showAddBudgetBtn.open .arrow,#viewbudgetToggle.open .arrow,
      #showAddCheckBtn.open .arrow, #viewCheckToggle.open .arrow,#viewRemindersToggle.open .arrow {
        transform: rotate(180deg);
        transition: left 0s;
      }

      /* Add this to your existing <style> block */
      .calendar-day {
          padding: 8px 4px;
          border: 1px solid #eee;
          height: 40px;
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: default;
      }
      .calendar-day.today {
          background: var(--accent);
          color: white;
          font-weight: bold;
          border-radius: 50%;
      }
      .calendar-day.spacer {
          background: transparent;
          border: none;
      }
      .calculator-mode.hidden { display: none; }
      .normal-btn {
          padding: 10px;
          font-size: 16px;
          border: none;
          border-radius: 6px;
          cursor: pointer;
      }
      .normal-btn.primary { background: #e0e0e0; color: #000; }
      .normal-btn.secondary { background: #ccc; color: #000; }

      /* Scrollable lists */
      .scrollable-list {
        max-height: 300px;
        overflow-y: auto;
        border: 1px solid #ccc;
        border-radius: 6px;
        padding: 8px;
        margin-top: 8px;
      }

      /* Scrollbar styling */
      .scrollable-list::-webkit-scrollbar {
        width: 8px;
        border-radius: 4px;
      }

      .scrollable-list::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 4px;
      }

      .scrollable-list::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 4px;
      }

      .scrollable-list::-webkit-scrollbar-thumb:hover {
        background: #555;
        border-radius: 4px;
      }

      /* Checklist status button */
      .status-btn {
        background: #007bff;
        color: white;
        border: none;
        padding: 4px 8px;
        border-radius: 4px;
        cursor: pointer;
        margin-right: 8px;
        font-size: 12px;
      }

      /* Branding footer */
      .branding-footer {
        position: fixed;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 12px;
        color: #666;
        text-align: center;
      }

      .branding-footer a {
        color: #666;
        text-decoration: none;
      }

      /* Notification Page Specific Styles */
      .notif-status-box {
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        background: #e0f7fa;
        border: 1px solid #b2ebf2;
      }
      .notif-status-box.denied {
        background: #ffebee;
        border: 1px solid #ffcdd2;
      }
      .notif-setting-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 0;
        border-bottom: 1px solid #eee;
      }
      .notif-setting-item:last-child {
        border-bottom: none;
      }
      .toggle-switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 24px;
      }
      .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }
      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: 0.4s;
        border-radius: 24px;
      }
      .slider:before {
        position: absolute;
        content: "";
        height: 16px;
        width: 16px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
      }
      input:checked + .slider {
        background-color: var(--accent);
      }
      input:checked + .slider:before {
        transform: translateX(26px);
      }
    </style>
  </head>
  <body>
    <div id="sidebar" class="sidebar">
      <div class="profile">
        <img
          id="profilePhoto"
          src="https://via.placeholder.com/40"
          alt="Profile"
          width="45"
          height="45"
          style="border-radius:50%;object-fit:cover;cursor:pointer;"
          onclick="document.getElementById('photoUpload').click()"
        />
        <h3 id="profileName">üë§ User</h3>
      </div>
      <input
        id="photoUpload"
        type="file"
        accept="image/*"
        style="display:none;"
      />

      <button class="menu-btn" data-page="home">üè† Home</button>
      <button class="menu-btn" data-page="reminders">‚è∞ Reminders</button>
      <button class="menu-btn" data-page="notes">üìù Notes</button>
      <button class="menu-btn" data-page="budget">üí∞ Budget Tracker</button>
      <button class="menu-btn" data-page="Check">‚úí Check List</button>
      <button class="menu-btn" data-page="utilities">üõ†Ô∏è Utilities</button>
      <button class="menu-btn" data-page="other">üé≤ Other Apps</button>

      <div id="settingsContainer" style="margin-top:auto;">
        <button id="settingsBtn" class="icon-btn" aria-expanded="false">
          ‚öôÔ∏è Settings ‚ñº
        </button>
        <div id="settingsPanel" class="settings-panel" aria-hidden="true">
          <button class="menu-btn" id="editNameBtn">‚úèÔ∏è Edit Name</button>
          <button class="icon-btn" id="darkModeBtn">üåô Dark Mode</button>

          <button
            class="menu-btn"
            data-page="notifications"
            id="notificationBtn"
          >
            üîî Notification Settings
          </button>

          <button class="menu-btn" data-page="terms">
            üí¢ Terms & Conditions
          </button>
          <button class="menu-btn" data-page="how">üßë‚Äçüè´ How to Use</button>
        </div>
      </div>
    </div>

    <div id="main" class="main">
      <button id="toggleBtn" class="toggle-btn">‚Æû</button>

      <div id="home" class="page">
        <h2>Home</h2>
        <div class="add-area">
          <button
            id="homeRemindersToggle"
            class="add-btn"
            aria-expanded="false"
          >
            ‚ö†Ô∏è REMINDERS <span class="arrow">‚ñº</span>
          </button>
          <div id="homeRemindersContainer" class="form"></div>
        </div>
        <div class="add-area">
          <button id="homeNotesToggle" class="add-btn" aria-expanded="false">
            üìù NOTES <span class="arrow">‚ñº</span>
          </button>
          <div id="homeNotesContainer" class="form" aria-hidden="true"></div>
        </div>
        <div class="add-area">
          <button id="homeBudgetsToggle" class="add-btn" aria-expanded="false">
            üí∞ BUDGET OVERVIEW <span class="arrow">‚ñº</span>
          </button>
          <div id="homeBudgetsContainer" class="form" aria-hidden="true"></div>
        </div>

        <div class="add-area">
          <button id="homeCheckToggle" class="add-btn" aria-expanded="false">
            ‚úí CHECK LIST <span class="arrow">‚ñº</span>
          </button>
          <div id="homeCheckContainer" class="form" aria-hidden="true"></div>
        </div>

        <div class="branding-footer">
          <a href="https://github.com/spydernet3" target="_blank"
            >By Spydernet</a
          >
        </div>
      </div>

      <div id="reminders" class="page hidden">
        <h2>Reminders</h2>
        <div class="add-area">
          <button id="showAddFormBtn" class="add-btn" aria-expanded="false">
            Ôºã ADD NEW REMINDER <span class="arrow">‚ñº</span>
          </button>
          <div id="reminderFormContainer" class="form" aria-hidden="true">
            <label
              >Title<input id="reminderTitle" type="text" placeholder="Title"
            /></label>
            <label>Start date<input id="startDate" type="date" /></label>
            <label>End date<input id="endDate" type="date" /></label>
            <div class="form-actions">
              <button id="saveReminderBtn" class="primary">Save</button>
              <button id="cancelReminderBtn" class="secondary">Cancel</button>
            </div>
          </div>
        </div>
        <div class="add-area">
          <button
            id="viewRemindersToggle"
            class="add-btn"
            aria-expanded="false"
          >
            üëÄ VIEW REMINDERS <span class="arrow">‚ñº</span>
          </button>
          <ul id="reminderList" class="list scrollable-list form"></ul>
        </div>
      </div>

      <div id="notes" class="page hidden">
        <h2>üìù Notes</h2>
        <div class="add-area">
          <button id="showAddNoteBtn" class="add-btn" aria-expanded="false">
            Ôºã ADD NEW NOTE <span class="arrow">‚ñº</span>
          </button>
          <div id="noteFormContainer" class="form" aria-hidden="true">
            <label>
              Attach File
              <input
                id="noteFile"
                type="file"
                accept="image/*,.pdf,.doc,.docx,.mp3,.mp4"
              />
            </label>

            <label>
              Note<textarea
                id="noteText"
                rows="4"
                placeholder="Write your note here..."
              ></textarea>
            </label>

            <label>
              Table Format<input type="checkbox" id="tableFormatCheckbox" />
              <span>Enable table format</span>
            </label>

            <div class="form-actions">
              <button id="saveNoteBtn" class="primary">Save</button>
              <button id="cancelNoteBtn" class="secondary">Cancel</button>
            </div>
          </div>
        </div>
        <div class="add-area">
          <button id="viewNotesToggle" class="add-btn" aria-expanded="false">
            üëÄ VIEW NOTES <span class="arrow">‚ñº</span>
          </button>
          <ul id="noteList" class="list scrollable-list form"></ul>
        </div>
      </div>

      <div id="budget" class="page hidden">
        <h2>üí∞ Budget Tracker</h2>

        <div class="add-area">
          <button id="showAddBudgetBtn" class="add-btn" aria-expanded="false">
            ‚ñ∂ ADD NEW BUDGET
          </button>
          <div id="budgetFormContainer" class="form" aria-hidden="true">
            <label
              >Title<input
                id="budgetTitle"
                type="text"
                placeholder="Budget title"
            /></label>
            <label
              >Total Amount (‚Çπ)<input
                id="budgetAmount"
                type="number"
                placeholder="Total Amount"
            /></label>
            <label>Start Date<input id="budgetStartDate" type="date" /></label>
            <label>End Date<input id="budgetEndDate" type="date" /></label>
            <div class="form-actions">
              <button id="saveBudgetBtn" class="primary">Save</button>
              <button id="cancelBudgetBtn" class="secondary">Cancel</button>
            </div>
          </div>
        </div>

        <div
          id="budgetExpenseFormContainer"
          class="form hidden"
          aria-hidden="true"
        >
          <h4 id="expenseBudgetTitle">Adding expense...</h4>
          <label
            >Amount (‚Çπ)<input
              id="expenseAmount"
              type="number"
              placeholder="Expense Amount"
          /></label>
          <label
            >Description<input
              id="expenseDescription"
              type="text"
              placeholder="What was this expense for?"
          /></label>
          <div class="form-actions">
            <button id="saveExpenseBtn" class="primary">Record Expense</button>
            <button id="cancelExpenseBtn" class="secondary">Cancel</button>
          </div>
        </div>

        <div class="add-area">
          <button id="viewbudgetToggle" class="add-btn" aria-expanded="false">
            ‚ñ∂ VIEW BUDGETS
          </button>
          <ul
            id="budgetList"
            class="list scrollable-list form visible"
            aria-hidden="false"
          ></ul>
        </div>
      </div>
      <div id="Check" class="page hidden">
        <h2>‚úí Check List</h2>
        <div class="add-area">
          <button id="showAddCheckBtn" class="add-btn" aria-expanded="false">
            Ôºã CREATE NEW CHECKLIST <span class="arrow">‚ñº</span>
          </button>
          <div id="checkFormContainer" class="form" aria-hidden="true">
            <label>
              Title<input
                id="checkTitle"
                type="text"
                placeholder="Checklist title"
              />
            </label>
            <label>
              Status<select id="checkStatus">
                <option value="open">Open</option>
                <option value="closed">Closed</option>
              </select>
            </label>
            <label>
              Items (one per line)<textarea
                id="checkItems"
                rows="4"
                placeholder="Item 1&#10;Item 2&#10;Item 3"
              ></textarea>
            </label>
            <div class="form-actions">
              <button id="saveCheckBtn" class="primary">Save</button>
              <button id="cancelCheckBtn" class="secondary">Cancel</button>
            </div>
          </div>
        </div>
        <div class="add-area">
          <button id="viewCheckToggle" class="add-btn" aria-expanded="false">
            üëÄ VIEW CHECKLISTS <span class="arrow">‚ñº</span>
          </button>
          <ul id="checkList" class="list scrollable-list form"></ul>
        </div>
      </div>

      <div id="notifications" class="page hidden">
        <h2>üîî Notification Settings</h2>

        <div id="globalNotifStatus" class="notif-status-box">
          <h3>Browser Permission</h3>
          <p id="browserPermissionText"></p>
          <button
            id="requestPermissionBtn"
            class="primary"
            style="margin-top: 10px;"
          >
            Request / Check Permission
          </button>
        </div>

        <h3>Notification Categories</h3>
        <p style="font-size: 14px; opacity: 0.8;">
          Note: Category notifications only work if the browser permission above
          is # Granted #.
        </p>

        <div class="notif-setting-item">
          <span>‚è∞ Reminder Page Reminders</span>
          <label class="toggle-switch">
            <input type="checkbox" id="toggleReminders" />
            <span class="slider"></span>
          </label>
        </div>

        <div class="notif-setting-item">
          <span>üìù Notes Reminders </span>
          <label class="toggle-switch">
            <input type="checkbox" id="toggleNotes" />
            <span class="slider"></span>
          </label>
        </div>

        <div class="notif-setting-item">
          <span>‚úí Checklist Reminders</span>
          <label class="toggle-switch">
            <input type="checkbox" id="toggleChecklist" />
            <span class="slider"></span>
          </label>
        </div>

        <div class="notif-setting-item">
          <span>üí∞ Budget Reminders</span>
          <label class="toggle-switch">
            <input type="checkbox" id="toggleBudget" />
            <span class="slider"></span>
          </label>
        </div>
      </div>

      <div id="terms" class="page hidden">
        <h1>Privacy Policy!</h1>
        <ul>
          <p>
            App data are stored using local storage. Avoid data losses before
            formatting the device.
          </p>
          <p>Maximum 500MB allowed to store user datas in local storage.</p>
          <p>
            Datas are synced as much as possible while page load after it
            depends on your browser behaviour
          </p>
          <p>
            Import & Export and Sharing datas are not allowed for security
            reasons
          </p>
          <p>
            Codes are carefully reviewed by ChatGPT and other AI Models Checkout
            Overall Rating in GitHub Readme file
          </p>
          <p>
            Would you like to contribute, check out here:
            <a href="https://github.com/spydernet3" target="_blank"
              >Spydernet Github ‚Ü†</a
            >
          </p>
        </ul>
        <hr />
        <h3>Version Info!</h3>
        <ul>
          <p>Version 13.4.7</p>
          <p>Last Updated: 27-Sep-2025</p>
          <p>Project Type: Open source</p>
        </ul>
      </div>

      <div id="how" class="page hidden">
        <h3>Install App</h3>
        <hr />
        <ul>
          <li>
            By Pressing Add to Home Screen Button There You can see Install App
            to install page as PWA
          </li>
          <li>In App Notification logic working here</li>
        </ul>
        <h3>Reminder!</h3>
        <hr />
        <ul>
          <li>Go to the Reminders page</li>
          <li>Click + Add New Reminder</li>
          <li>Fill Title, Start Date, End Date</li>
          <li>Click Save</li>
          <li>Edit or delete using the ‚úèÔ∏è and üóëÔ∏è button.</li>
          <li>
            Today & Tomorrow Due reminders will appeared on the Home page
            automatically.
          </li>
        </ul>

        <h3>Notes!</h3>
        <hr />
        <ul>
          <li>Go to the Notes page.</li>
          <li>Click + Add New Note.</li>
          <li>Write your note in the textarea.</li>
          <li>It supports file formats (Images, pdf, audio, video, docs).</li>
          <li>Click Save. IST date & time are added automatically.</li>
          <li>Edit or delete using the ‚úèÔ∏è and üóëÔ∏è button.</li>
        </ul>

        <h3>Budget Tracker!</h3>
        <hr />
        <ul>
          <li>Go to the Budget Tracker page.</li>
          <li>Click + Add New Budget.</li>
          <li>That will showed Total Amount/Remaining Days</li>
          <li>That will shows Cost per day How much you need to spend</li>
          <li>
            At Budget reminder it reminders your spend limit hole day with 5
            Mins Interval
          </li>
          <li>Edit or delete using the ‚úèÔ∏è and üóëÔ∏è button.</li>
        </ul>

        <h3>Profile!</h3>
        <hr />
        <ul>
          <li>Click the profile picture to upload a new image.</li>
          <li>Click Edit Name to update the username now under Settings.</li>
        </ul>
        <h3>Checklist!</h3>
        <hr />
        <ul>
          <li>Create checklist and set status either Open/Closed</li>
          <li>Opened checklist listed in Home screen</li>
        </ul>
        <h3>Dark Mode!</h3>
        <hr />
        <ul>
          <li>
            Open Settings (‚öôÔ∏è) in the sidebar, then click the üåô button to
            toggle dark mode.
          </li>
          <li>Dark mode preference is saved.</li>
        </ul>
        <h3>Notification!</h3>
        <hr />
        <ul>
          <li>Notification will showed once page is active</li>
          <li>You will Turn Notification On/Off</li>
          <li>
            When app is active then only Notification showed,Background push
            Notification's are restricted
          </li>
          <li>You can customize notification as per your requirements</li>
        </ul>
        <h3>Offline Mode</h3>
        <hr />
        <ul>
          <li>
            Step: Download Source Code Zip File in your Device and Extract foder
            then Open index.html without internet in any broweser.
          </li>
          <li>Note: notifications are not supposed to working</li>
        </ul>
      </div>

      <div id="utilities" class="page hidden">
        <h2>üõ†Ô∏è Utilities</h2>
        <div class="add-area">
          <button
            id="monthlyCalendarToggle"
            class="add-btn"
            aria-expanded="false"
          >
            üìÖ MONTHLY CALENDAR <span class="arrow">‚ñº</span>
          </button>
          <div id="monthlyCalendarContainer" class="form" aria-hidden="true">
            <div
              id="calendarDisplay"
              style="padding: 10px; border: 1px solid #ddd; border-radius: 6px;"
            >
              <div
                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;"
              >
                <button id="prevMonthBtn" class="secondary">‚óÄ</button>
                <h4 id="currentMonthYear"></h4>
                <button id="nextMonthBtn" class="secondary">‚ñ∂</button>
              </div>
              <div
                id="calendarGrid"
                style="display: grid; grid-template-columns: repeat(7, 1fr); text-align: center; font-size: 14px;"
              >
                <div>S</div>
                <div>M</div>
                <div>T</div>
                <div>W</div>
                <div>T</div>
                <div>F</div>
                <div>S</div>
              </div>
            </div>
          </div>
        </div>

        <div class="add-area">
          <button id="calculatorToggle" class="add-btn" aria-expanded="false">
            üßÆ CALCULATOR <span class="arrow">‚ñº</span>
          </button>
          <div id="calculatorContainer" class="form" aria-hidden="true">
            <label>
              Select Mode:
              <select id="calculatorMode">
                <option value="normal">Normal Calculator</option>
                <option value="age">Age Calculator</option>
                <option value="date">Date Difference Calculator</option>
                <option value="scientific" disabled>
                  Scientific Calculator (WIP)
                </option>
              </select>
            </label>
            <div id="normalCalculator" class="calculator-mode">
              <input
                type="text"
                id="normalDisplay"
                value="0"
                readonly
                style="text-align: right; font-size: 20px; margin-bottom: 8px;"
              />
              <div
                style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px;"
              >
                <button
                  class="secondary normal-btn"
                  data-value="clear"
                  style="grid-column: span 2;"
                >
                  C
                </button>
                <button class="secondary normal-btn" data-value="backspace">
                  ‚å´
                </button>
                <button class="secondary normal-btn" data-value="/">/</button>

                <button class="primary normal-btn" data-value="7">7</button>
                <button class="primary normal-btn" data-value="8">8</button>
                <button class="primary normal-btn" data-value="9">9</button>
                <button class="secondary normal-btn" data-value="*">*</button>

                <button class="primary normal-btn" data-value="4">4</button>
                <button class="primary normal-btn" data-value="5">5</button>
                <button class="primary normal-btn" data-value="6">6</button>
                <button class="secondary normal-btn" data-value="-">-</button>

                <button class="primary normal-btn" data-value="1">1</button>
                <button class="primary normal-btn" data-value="2">2</button>
                <button class="primary normal-btn" data-value="3">3</button>
                <button class="secondary normal-btn" data-value="+">+</button>

                <button
                  class="primary normal-btn"
                  data-value="."
                  style="font-weight: bold;"
                >
                  .
                </button>
                <button class="primary normal-btn" data-value="0">0</button>
                <button
                  class="primary normal-btn"
                  data-value="equals"
                  style="grid-column: span 2; background: var(--accent);"
                >
                  = Save & Calc
                </button>
              </div>
            </div>
            <div id="ageCalculator" class="calculator-mode hidden">
              <label>Date of Birth <input type="date" id="dobInput" /></label>
              <label>As of Date <input type="date" id="asOfDateInput" /></label>
              <div class="form-actions">
                <button id="calculateAgeBtn" class="primary">
                  Calculate Age
                </button>
              </div>
              <p id="ageResult" style="margin-top: 10px; font-weight: 600;"></p>
            </div>
            <div id="dateCalculator" class="calculator-mode hidden">
              <label>Start Date <input type="date" id="dateDiffStart" /></label>
              <label>End Date <input type="date" id="dateDiffEnd" /></label>
              <div class="form-actions">
                <button id="calculateDateDiffBtn" class="primary">
                  Calculate Difference
                </button>
              </div>
              <p
                id="dateDiffResult"
                style="margin-top: 10px; font-weight: 600;"
              ></p>
            </div>
          </div>
        </div>
        <div class="add-area">
          <button id="viewHistoryToggle" class="add-btn" aria-expanded="false">
            ‚è≥ VIEW HISTORY <span class="arrow">‚ñº</span>
          </button>
          <ul
            id="calculationHistoryList"
            class="list scrollable-list form"
            aria-hidden="true"
          ></ul>
        </div>
      </div>

      <div id="other" class="page hidden">
        <h2>üé≤ Other Apps</h2>
        <div
          style="display: flex; flex-wrap: wrap; gap: 20px; margin-top: 20px;"
        >
          <a
            href="https://you-tube-seven.vercel.app/"
            target="_blank"
            style="text-decoration: none; color: inherit;"
          >
            <button class="menu-btn" style="width: 180px;">
              YouTube Filter
            </button>
          </a>
          <a
            href="https://spydernet3.github.io/QR-Generator/"
            target="_blank"
            style="text-decoration: none; color: inherit;"
          >
            <button class="menu-btn" style="width: 180px;">QR Generator</button>
          </a>
          <a
            href="https://spydernet3.github.io/multi_website_browser/"
            target="_blank"
            style="text-decoration: none; color: inherit;"
          >
            <button class="menu-btn" style="width: 180px;">
              Multi Website Browser
            </button>
          </a>
          <a
            href="https://spydernet3.github.io/Battery_Health_Monitor/"
            target="_blank"
            style="text-decoration: none; color: inherit;"
          >
            <button class="menu-btn" style="width: 180px;">
              Battery Health Monitor
            </button>
          </a>
          <a
            href="https://spydernet3.github.io/farewell/"
            target="_blank"
            style="text-decoration: none; color: inherit;"
          >
            <button class="menu-btn" style="width: 180px;">
              Farewell Wishes
            </button>
          </a>
          <a
            href="https://spydernet3.github.io/live-audio-transcrib/"
            target="_blank"
            style="text-decoration: none; color: inherit;"
          >
            <button class="menu-btn" style="width: 180px;">Email Alert</button>
          </a>
          <a
            href="https://github.com/spydernet3/Text-messaging-alert"
            target="_blank"
            style="text-decoration: none; color: inherit;"
          >
            <button class="menu-btn" style="width: 180px;">SmS Alert</button>
          </a>
          <a
            href="https://spydernet3.github.io/live-audio-transcrib/"
            target="_blank"
            style="text-decoration: none; color: inherit;"
          >
            <button class="menu-btn" style="width: 180px;">
              Live Audio Transcrib
            </button>
          </a>
          <a
            href="https://spydernet3.github.io/Notepad/"
            target="_blank"
            style="text-decoration: none; color: inherit;"
          >
            <button class="menu-btn" style="width: 180px;">Notepad</button>
          </a>
          <a
            href="https://spydernet3.github.io/Smart-Card/"
            target="_blank"
            style="text-decoration: none; color: inherit;"
          >
            <button class="menu-btn" style="width: 180px;">Smart Card</button>
          </a>
        </div>
      </div>
    </div>
    <script>
      // Uses the standard registration method, pointing to 'service-worker.js' in the root.
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('service-worker.js')
            .then((registration) => {
              console.log('SW registered successfully:', registration);
            })
            .catch((error) => {
              console.error('SW registration failed:', error);
            });
        });
      }

      (function () {
        // ---------- Helpers ----------
        function byId(id){ return document.getElementById(id); }

        // Function to show/hide collapsible forms/sections (Handles the ‚ñ∂ / ‚ñº arrow)
        function toggleCollapse(el, btn){
            el.classList.toggle('visible');
            btn.classList.toggle('open');

            if (btn.textContent.includes('‚ñ∂')) {
                btn.textContent = btn.textContent.replace('‚ñ∂', '‚ñº');
            } else if (btn.textContent.includes('‚ñº')) {
                btn.textContent = btn.textContent.replace('‚ñº', '‚ñ∂');
            }
        }

        // Generic form functions
        function showForm(el) { el.classList.add('visible'); }
        function hideForm(el) { el.classList.remove('visible'); }

        // Helper to safely convert a value to a number, preventing 'toFixed' errors
        function safeNum(value) {
            const num = parseFloat(value);
            return isNaN(num) ? 0 : num;
        }


        // ---------- NEW: Notification Settings Logic (Placeholders) ----------
        function updateBrowserPermissionUI() {
            /* Placeholder */
        }

        function requestNotificationPermission() {
          /* Placeholder */
        }

        function renderNotificationPage() {
            /* Placeholder */
        }

        function handleCustomNotifToggle(category, event) {
            /* Placeholder */
        }
        async function checkNotifications() { /* Placeholder */ }
        // ---------- END Notification Logic ----------

        // ---------- Storage and Data Initialization ----------

        const STORAGE_KEY = 'smart_reminder_app_v1';

        const defaultData = {
          reminders: [],
          notes: [],
          profileName: '',
          profilePhoto: '',
          darkMode: '0',
          budget: [],
          checklists: [],
          notifReminders: true,
          notifNotes: true,
          notifChecklist: true,
          notifBudget: true,
          calculationHistory: []
        };

        let appData = JSON.parse(localStorage.getItem(STORAGE_KEY)) || defaultData;
        appData = { ...defaultData, ...appData };
        if (!appData.calculationHistory) appData.calculationHistory = [];

        // Budget Data Migration/Initialization (Crucial for fixing the toFixed error)
        appData.budget.forEach(b => {
            if (!b.id) b.id = Date.now().toString() + Math.random().toFixed(4).replace('0.', '');

            // Initialize new fields, using safeNum
            b.originalAmount = safeNum(b.originalAmount || b.amount);
            b.expenses = Array.isArray(b.expenses) ? b.expenses : [];

            // Recalculate balance based on expenses
            const totalSpent = b.expenses.reduce((sum, exp) => sum + safeNum(exp.amount), 0);
            b.currentBalance = safeNum(b.originalAmount) - totalSpent;

            b.amount = b.originalAmount; // For compatibility
        });


        let editingIndex = null;
        let editingBudgetIndex = null;
        let editingCheckIndex = null;
        let editingNoteIndex = null;
        let editingHistoryIndex = null;
        let currentExpenseBudgetId = null;

        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();


        // Modified save function
        async function saveAll() {
          try {
            const dataStr = JSON.stringify(appData);
            localStorage.setItem(STORAGE_KEY, dataStr);
            console.log("Data saved successfully to localStorage.");
            if (byId('notifications') && !byId('notifications').classList.contains('hidden')) {
                renderNotificationPage();
            }
            await checkNotifications();
          } catch (err) {
            console.error("Save failed:", err);
            if (err.name === 'QuotaExceededError') {
              console.error("Storage is full. Please delete some data to make space.");
            }
          }
        }

        // --- Utility Functions ---

        function daysLeft(endDateStr){
          if(!endDateStr) return null;
          const [y,m,d] = endDateStr.split('-').map(Number);
          const end = new Date(y,m-1,d);
          const now = new Date();
          const diffTime = end.setHours(0,0,0,0) - now.setHours(0,0,0,0);
          return Math.floor(diffTime / (1000*60*60*24));
        }

        function formatDMY(dateStr){
          if(!dateStr) return '';
          const [y,m,d] = dateStr.split('-');
          return `${d.toString().padStart(2,'0')}/${m.toString().padStart(2,'0')}/${y}`;
        }

        function formatDateDMYWithTime(date) {
          const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',
                         'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
          const day = date.getDate().toString().padStart(2, '0');
          const month = months[date.getMonth()];
          const year = date.getFullYear();

          const istHours = date.getHours();
          const istMinutes = date.getMinutes().toString().padStart(2, '0');
          const ampm = istHours >= 12 ? 'PM' : 'AM';
          const displayHours = istHours % 12 || 12;

          return `${day}-${month}-${year} ${displayHours}:${istMinutes} ${ampm}`;
        }

        function daysBetween(startDateStr, endDateStr) {
          if (!startDateStr || !endDateStr) return 0;
          const [startY, startM, startD] = startDateStr.split('-').map(Number);
          const [endY, endM, endD] = endDateStr.split('-').map(Number);
          const start = new Date(startY, startM-1, startD);
          const end = new Date(endY, endM-1, endD);
          const diffTime = end.setHours(0,0,0,0) - start.setHours(0,0,0,0);
          return Math.floor(diffTime / (1000*60*60*24)) + 1;
        }

        function calculateCostPerDay(amount, startDate, endDate) {
          const days = daysBetween(startDate, endDate);
          if (days <= 0 || amount <= 0) return 0;
          return (amount / days).toFixed(2);
        }

        // --- REMINDER, NOTE, CHECKLIST, HISTORY FUNCTIONS (Omitted for brevity) ---
        function renderReminders(){ /* Placeholder */ }
        function renderHomeReminders(){ /* Placeholder */ }
        function renderHomeNotes(){ /* Placeholder */ }
        function renderNotes(){ /* Placeholder */ }
        function renderHomeCheck(){ /* Placeholder */ }
        function renderChecklists(){ /* Placeholder */ }
        function renderHistory() { /* Placeholder */ }
        function switchCalculatorMode() { /* Placeholder */ }

        // ---------- Budget Functions (CORE) ----------

        function renderBudgets(){
          const list = byId('budgetList'); list.innerHTML = '';
          if (!appData.budget || !Array.isArray(appData.budget) || appData.budget.length === 0) {
            const li = document.createElement('li');
            li.textContent='No budgets yet. Use "‚ñ∂ ADD NEW BUDGET" to start.';
            li.style.opacity='0.7';
            list.appendChild(li);
            renderHomeBudgets();
            return;
          }

          const frag = document.createDocumentFragment();
          appData.budget.forEach((b,i)=>{
            const originalAmount = safeNum(b.originalAmount || b.amount);
            const currentBalance = safeNum(b.currentBalance);
            const expenses = Array.isArray(b.expenses) ? b.expenses : [];

            const li=document.createElement('li');
            li.style.flexDirection = 'column';

            const headerDiv = document.createElement('div');
            headerDiv.style.display = 'flex';
            headerDiv.style.justifyContent = 'space-between';
            headerDiv.style.width = '100%';

            const left=document.createElement('div'); left.className='item-left';

            const costPerDay = calculateCostPerDay(originalAmount, b.startDate, b.endDate);
            const days = daysBetween(b.startDate, b.endDate);

            const title=document.createElement('div');
            title.textContent=`Budget: ${b.title}`;
            title.style.fontWeight='700';
            title.style.marginBottom = '5px';

            const budgetStatusDiv = document.createElement('div');
            budgetStatusDiv.style.padding = '8px';
            budgetStatusDiv.style.backgroundColor = 'rgba(76, 175, 80, 0.1)';
            budgetStatusDiv.style.borderRadius = '4px';

            const statusColor = currentBalance < 0 ? '#f44336' : 'var(--accent)';

            budgetStatusDiv.innerHTML = `
                <div><b>Original Budget:</b> ‚Çπ${originalAmount.toFixed(2)}</div>
                <div><b>Remaining Balance:</b> <span style="color: ${statusColor}; font-weight: bold;">‚Çπ${currentBalance.toFixed(2)}</span></div>
                <div style="font-size: 13px; opacity: 0.85; margin-top: 5px;">
                    Period: ${formatDMY(b.startDate)} to ${formatDMY(b.endDate)} | Days: ${days} | Cost per Day: ‚Çπ${costPerDay}
                </div>
            `;

            left.appendChild(title);
            left.appendChild(budgetStatusDiv);

            const historyDiv = document.createElement('div');
            historyDiv.style.marginTop = '10px';
            historyDiv.style.padding = '8px';
            historyDiv.style.backgroundColor = 'rgba(244, 67, 54, 0.05)';
            historyDiv.style.borderRadius = '4px';
            historyDiv.style.width = '100%';

            let historyHtml = '<b>Expense History:</b> (' + expenses.length + ' records)';

            if (expenses.length > 0) {
                const recentExpenses = expenses.slice(-3).reverse();

                historyHtml += '<ul style="list-style-type: none; padding-left: 0; margin: 5px 0 0;">';
                recentExpenses.forEach(exp => {
                    const expenseAmount = safeNum(exp.amount).toFixed(2);
                    const expenseTimestamp = exp.timestamp ? exp.timestamp.split(' ')[0] : 'N/A';
                    historyHtml += `<li style="font-size: 13px; border-bottom: 1px solid rgba(0,0,0,0.05); padding: 2px 0;">
                        <span style="font-weight: 600; color: #f44336;">- ‚Çπ${expenseAmount}</span> - ${exp.description}
                        <small style="opacity: 0.7; float: right;">${expenseTimestamp}</small>
                    </li>`;
                });
                historyHtml += '</ul>';

                if (expenses.length > 3) {
                     historyHtml += `<div style="font-size: 13px; opacity: 0.7; text-align: center; margin-top: 5px;">...Showing 3 of ${expenses.length} records...</div>`;
                }
            } else {
                historyHtml += '<div style="font-size: 13px; opacity: 0.7; margin-top: 5px;">No expenses recorded yet.</div>';
            }

            historyDiv.innerHTML = historyHtml;

            const right=document.createElement('div');
            right.style.display='flex'; right.style.alignItems='flex-start';

            const expenseBtn = document.createElement('button');
            expenseBtn.className = 'icon-small';
            expenseBtn.textContent = '‚ûï';
            expenseBtn.title = 'Add Expense';
            expenseBtn.addEventListener('click', () => showExpenseForm(b.id));

            const editBtn=document.createElement('button'); editBtn.className='icon-small'; editBtn.textContent='‚úèÔ∏è'; editBtn.title='Edit Budget'; editBtn.addEventListener('click',()=>editBudget(i));
            const delBtn=document.createElement('button'); delBtn.className='icon-small'; delBtn.textContent='üóëÔ∏è'; delBtn.title='Delete Budget'; delBtn.addEventListener('click',()=>deleteBudget(i));

            right.appendChild(expenseBtn);
            right.appendChild(editBtn);
            right.appendChild(delBtn);

            headerDiv.appendChild(left);
            headerDiv.appendChild(right);

            li.appendChild(headerDiv);
            li.appendChild(historyDiv);

            frag.appendChild(li);
          });
          list.appendChild(frag);
          renderHomeBudgets();
        }

        function renderHomeBudgets(){
          const container = byId('homeBudgetsContainer');
          container.innerHTML='';
          if (!appData.budget || !Array.isArray(appData.budget) || appData.budget.length === 0) {
            const li=document.createElement('li');
            li.textContent='No budgets yet.';
            li.style.opacity='0.7';
            container.appendChild(li);
            return;
          }
          const frag=document.createDocumentFragment();
          appData.budget.forEach(b=>{
            const originalAmount = safeNum(b.originalAmount || b.amount);
            const currentBalance = safeNum(b.currentBalance);

            const statusColor = currentBalance < 0 ? '#f44336' : 'var(--accent)';

            const li=document.createElement('li');
            li.innerHTML = `\"${b.title}\" || Total: ‚Çπ${originalAmount.toFixed(2)} || <b style="color: ${statusColor};">Remaining: ‚Çπ${currentBalance.toFixed(2)}</b>`;
            frag.appendChild(li);
          });
          container.appendChild(frag);
        }

        function editBudget(i){
          const b=appData.budget[i];
          editingBudgetIndex=i;
          byId('budgetTitle').value=b.title;
          byId('budgetAmount').value=safeNum(b.originalAmount || b.amount);
          byId('budgetStartDate').value=b.startDate||'';
          byId('budgetEndDate').value=b.endDate||'';
          showForm(byId('budgetFormContainer'));
        }

        function deleteBudget(index){
          appData.budget.splice(index, 1);
          saveAll();
          renderBudgets();
          renderHomeBudgets();
        }

        function saveBudget(){
          const title=byId('budgetTitle').value.trim();
          const amount=parseFloat(byId('budgetAmount').value);
          const start=byId('budgetStartDate').value;
          const end=byId('budgetEndDate').value;

          if(!title || isNaN(amount) || amount <= 0){ alert('Title and a valid amount are required to save a budget.'); return; }

          let budgetObj;
          if(editingBudgetIndex!==null){
              budgetObj = appData.budget[editingBudgetIndex];
              if (safeNum(budgetObj.originalAmount) !== amount) {
                  budgetObj.originalAmount = amount;
                  const expenses = Array.isArray(budgetObj.expenses) ? budgetObj.expenses : [];
                  const totalSpent = expenses.reduce((sum, exp) => sum + safeNum(exp.amount), 0);
                  budgetObj.currentBalance = amount - totalSpent;
              }

              budgetObj.title = title;
              budgetObj.startDate = start;
              budgetObj.endDate = end;
              budgetObj.amount = amount;

              editingBudgetIndex=null;
          }
          else{
              budgetObj={
                  id: Date.now().toString(),
                  title: title,
                  amount: amount,
                  originalAmount: amount,
                  currentBalance: amount,
                  startDate: start,
                  endDate: end,
                  expenses: []
              };
              appData.budget.push(budgetObj);
          }

          saveAll();
          renderBudgets();
          hideForm(byId('budgetFormContainer'));
          clearBudgetForm();
        }

        function clearBudgetForm(){
          byId('budgetTitle').value='';
          byId('budgetAmount').value='';
          byId('budgetStartDate').value='';
          byId('budgetEndDate').value='';
        }

        // Function to prepare and show the expense form
        function showExpenseForm(budgetId) {
            currentExpenseBudgetId = budgetId;
            const budget = appData.budget.find(b => b.id === budgetId);
            if (!budget) return;

            const expenseTitleEl = byId('expenseBudgetTitle');
            if(expenseTitleEl) expenseTitleEl.textContent = `Adding expense to: ${budget.title}`;

            const expenseForm = byId('budgetExpenseFormContainer');
            if (expenseForm) {
                if(byId('expenseAmount')) byId('expenseAmount').value = '';
                if(byId('expenseDescription')) byId('expenseDescription').value = '';
                showForm(expenseForm);
            }
        }

        // Function to record and save an expense
        function saveExpense(budgetId, expenseAmount, expenseDescription) {
            const amount = safeNum(expenseAmount);
            const description = expenseDescription.trim();

            if (amount <= 0 || !description) {
                alert('Please enter a valid amount and description for the expense.');
                return;
            }

            const budget = appData.budget.find(b => b.id === budgetId);
            if (!budget) {
                console.error('Budget not found for ID:', budgetId);
                return;
            }

            budget.currentBalance = safeNum(budget.currentBalance) - amount;

            const expenseObj = {
                amount: amount,
                description: description,
                timestamp: formatDateDMYWithTime(new Date())
            };

            if (!Array.isArray(budget.expenses)) budget.expenses = [];
            budget.expenses.push(expenseObj);

            saveAll();
            renderBudgets();
            hideForm(byId('budgetExpenseFormContainer'));
        }

        // Function to be called by the Expense Form Submit button
        function doSaveExpenseFromForm() {
            const amount = byId('expenseAmount').value;
            const description = byId('expenseDescription').value;
            if (currentExpenseBudgetId) {
                saveExpense(currentExpenseBudgetId, amount, description);
            }
        }
        // ---------- End Budget Functions ----------


        // --- Initialisation and Event Listeners ---

        window.onload = function() {
          const toggleBtn = byId('sidebarToggle');
          const sidebar = byId('sidebar');
          const main = byId('main');

          // Sidebar Toggle Logic
          if (toggleBtn && sidebar && main) {
              toggleBtn.addEventListener('click', function() {
                  sidebar.style.transition = 'left 0.3s ease';
                  main.style.transition = 'margin-left 0.3s ease';

                  if (sidebar.style.left === '-220px' || sidebar.style.left === '') {
                    sidebar.style.left = '0px';
                    main.style.marginLeft = '220px';
                    toggleBtn.textContent = '‚Æú';
                  } else {
                    sidebar.style.left = '-220px';
                    main.style.marginLeft = '0';
                    toggleBtn.textContent = '‚Æû';
                  }
              });
          }

          // --- FORM TOGGLE BINDINGS ---
          // Budget Form
          const showAddBudgetBtn = byId('showAddBudgetBtn');
          if (showAddBudgetBtn) showAddBudgetBtn.addEventListener('click', () => toggleCollapse(byId('budgetFormContainer'), showAddBudgetBtn));

          // Budget List View Toggle
          const viewbudgetToggle = byId('viewbudgetToggle');
          if (viewbudgetToggle) viewbudgetToggle.addEventListener('click', () => toggleCollapse(byId('budgetList'), viewbudgetToggle));

          // Cancel Buttons (hiding forms)
          const cancelBudgetBtn = byId('cancelBudgetBtn');
          if (cancelBudgetBtn) cancelBudgetBtn.addEventListener('click', () => hideForm(byId('budgetFormContainer')));

          const cancelExpenseBtn = byId('cancelExpenseBtn');
          if (cancelExpenseBtn) cancelExpenseBtn.addEventListener('click', () => hideForm(byId('budgetExpenseFormContainer')));


          // Initial Renders (Placeholders)
          if (appData.darkMode === '1') document.body.classList.add('dark');
          renderReminders();
          renderNotes();
          renderBudgets(); // CRUCIAL: Must run on load
          renderChecklists();
          renderHistory();
          switchCalculatorMode();

          // Notification Setup
          if ("Notification" in window) {
              updateBrowserPermissionUI();
              checkNotifications();
          }

          // --- SAVE BUTTON BINDINGS ---
          // Budget Save
          const budgetSaveBtn = byId('saveBudgetBtn');
          if(budgetSaveBtn) budgetSaveBtn.addEventListener('click', saveBudget);

          // Expense Save (Crucial for the new logic)
          const expenseSaveBtn = byId('saveExpenseBtn');
          if(expenseSaveBtn) expenseSaveBtn.addEventListener('click', doSaveExpenseFromForm);

          // Notification Toggles (If present in HTML)
          if(byId('toggleReminders')) byId('toggleReminders').addEventListener('change', (e) => handleCustomNotifToggle('notifReminders', e));
          if(byId('toggleNotes')) byId('toggleNotes').addEventListener('change', (e) => handleCustomNotifToggle('notifNotes', e));
          if(byId('toggleChecklist')) byId('toggleChecklist').addEventListener('change', (e) => handleCustomNotifToggle('notifChecklist', e));
          if(byId('toggleBudget')) byId('toggleBudget').addEventListener('change', (e) => handleCustomNotifToggle('notifBudget', e));
        };
      })();
    </script>
  </body>
</html>
