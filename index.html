<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Nothing Reminder</title>
    <link rel="icon" type="image/png" href="assets/icon.png" />
    <link rel="icon" type="image/png" href="assets/icon.png" />
    <link rel="manifest" href="manifest.json" />
    <style>
      :root {
        --bg: #ffffff;
        --text: #000000;
        --muted: #666;
        --accent: #4caf50;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue",
          Arial;
        background: var(--bg);
        color: var(--text);
      }
      .sidebar {
        width: 220px;
        background: #666;
        color: #fff;
        position: fixed;
        height: 100%;
        left: 0;
        display: flex;
        flex-direction: column;
        padding: 12px;
        gap: 8px;
        transition: left 0s;
      }
      .profile {
        display: flex;
        align-items: center;
        gap: 18px;
        margin-bottom: 8px;
      }
      .menu-btn,
      .icon-btn,
      .add-btn {
        display: block;
        width: 100%;
        padding: 10px;
        border: none;
        background: #888;
        font-style: Italic;
        color: #fff;
        border-radius: 6px;
        cursor: pointer;
        text-align: left;
        font-size: 15px;
        transition: left 0s;
      }
      .menu-btn:hover,
      .icon-btn:hover,
      .add-btn:hover {
        background: #aaa;
      }
      .main {
        margin-left: 220px;
        padding: 20px;
        min-height: 100vh;
        transition: margin-left 0s;
      }
      .page.hidden {
        display: none;
      }
      .toggle-btn {
        position: absolute;
        left: 210px; /* Adjusted to show partial icon */
        top: 12px;
        padding: 6px 8px;
        border-radius: 8px;
        border: none;
        background: #ddd;
        cursor: pointer;
        transition: left 0s;
        z-index: 10;
        width: 20px; /* Make it smaller to show partial icon */
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .list {
        list-style: none;
        padding: 0;
        margin: 0 0 12px 0;
      }
      .list li {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 8px;
        border-radius: 6px;
        margin-bottom: 8px;
        background: rgba(0, 0, 0, 0.03);
        transition: left 0s;
      }
      .item-left {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }
      .badge {
        background: #eee;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 12px;
      }
      .form {
        margin-top: 0;
        padding: 12px;
        border-radius: 8px;
        background: #f5f5f5;
        display: flex;
        flex-direction: column;
        gap: 8px;
        max-width: 520px;
        overflow: hidden;
        transition: max-height 0s ease, padding 0s ease;
        max-height: 0;
        padding-top: 0;
        padding-bottom: 0;
        transition: left 0s;
      }
      .form.visible {
        max-height: 500px;
        padding-top: 12px;
        padding-bottom: 12px;
      }
      .form label {
        display: flex;
        flex-direction: column;
        font-size: 13px;
        gap: 6px;
        transition: left 0s;
      }
      .form input[type="text"],
      .form input[type="date"],
      .form textarea,
      .form select {
        padding: 8px;
        border-radius: 6px;
        border: 1px solid #ccc;
        transition: left 0s;
      }
      .form-actions {
        display: flex;
        gap: 8px;
        margin-top: 6px;
        transition: left 0s;
      }
      .primary {
        background: var(--accent);
        color: #fff;
        border: none;
        padding: 8px 12px;
        border-radius: 6px;
        cursor: pointer;
      }
      .secondary {
        background: #ddd;
        border: none;
        padding: 8px 12px;
        border-radius: 6px;
        cursor: pointer;
      }
      .icon-small {
        background: transparent;
        border: none;
        cursor: pointer;
        margin-left: 8px;
        font-size: 16px;
      }
      .add-area {
        margin-top: 8px;
        max-width: 520px;
      }
      .dark {
        --bg: #121212;
        --text: #f1f1f1;
      }
      .dark .main {
        background: #151515;
        color: var(--text);
      }
      .dark .form {
        background: #232323;
      }
      .dark .menu-btn,
      .dark .icon-btn {
        background: #333;
        color: var(--text);
      }

      /* Settings panel styles */
      .settings-panel {
        display: none;
        flex-direction: column;
        gap: 8px;
        margin-top: 8px;
      }
      .settings-panel.visible {
        display: flex;
      }

      /* Consistent button styling for all sections */
      #showAddFormBtn,
      #homeRemindersToggle,
      #showAddNoteBtn,
      #viewNotesToggle,
      #homeNotesToggle,
      #homeBudgetsToggle,
      #homeCheckToggle,
      #showAddBudgetBtn,
      #viewbudgetToggle,
      #showAddCheckBtn,
      #viewCheckToggle,
      #viewRemindersToggle,
      #monthlyCalendarToggle,
      #calculatorToggle,
      #viewHistoryToggle {
        position: relative;
        user-select: none;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: 600;
        font-size: 15px;
        cursor: pointer;
        transition: left 0s;
        padding: 10px;
        border: none;
        background: #888;
        color: #fff;
        border-radius: 6px;
        text-align: left;
      }

      #showAddFormBtn:hover,
      #homeRemindersToggle:hover,
      #showAddNoteBtn:hover,
      #viewNotesToggle:hover,
      #homeNotesToggle:hover,
      #homeBudgetsToggle:hover,
      #homeCheckToggle:hover,
      #showAddBudgetBtn:hover,
      #viewbudgetToggle:hover,
      #showAddCheckBtn:hover,
      #viewCheckToggle:hover,
      #viewRemindersToggle:hover {
        background: #aaa;
      }

      #showAddFormBtn.open .arrow,
      #homeRemindersToggle.open .arrow,
      #showAddNoteBtn.open .arrow,
      #viewNotesToggle.open .arrow,
      #homeNotesToggle.open .arrow,
      #homeBudgetsToggle.open .arrow,
      #homeCheckToggle.open .arrow,
      #showAddBudgetBtn.open .arrow,
      #viewbudgetToggle.open .arrow,
      #showAddCheckBtn.open .arrow,
      #viewCheckToggle.open .arrow,
      #viewRemindersToggle.open .arrow {
        transform: rotate(180deg);
        transition: left 0s;
      }

      /* Add this to your existing <style> block */
      .calendar-day {
        padding: 8px 4px;
        border: 1px solid #eee;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: default;
      }
      .calendar-day.today {
        background: var(--accent);
        color: white;
        font-weight: bold;
        border-radius: 50%;
      }
      .calendar-day.spacer {
        background: transparent;
        border: none;
      }
      .calculator-mode.hidden {
        display: none;
      }
      .normal-btn {
        padding: 10px;
        font-size: 16px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
      }
      .normal-btn.primary {
        background: #e0e0e0;
        color: #000;
      }
      .normal-btn.secondary {
        background: #ccc;
        color: #000;
      }

      /* Scrollable lists */
      .scrollable-list {
        max-height: 300px;
        overflow-y: auto;
        border: 1px solid #ccc;
        border-radius: 6px;
        padding: 8px;
        margin-top: 8px;
      }

      /* Scrollbar styling */
      .scrollable-list::-webkit-scrollbar {
        width: 8px;
        border-radius: 4px;
      }

      .scrollable-list::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 4px;
      }

      .scrollable-list::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 4px;
      }

      .scrollable-list::-webkit-scrollbar-thumb:hover {
        background: #555;
        border-radius: 4px;
      }

      /* Checklist status button */
      .status-btn {
        background: #007bff;
        color: white;
        border: none;
        padding: 4px 8px;
        border-radius: 4px;
        cursor: pointer;
        margin-right: 8px;
        font-size: 12px;
      }

      /* Branding footer */
      .branding-footer {
        position: fixed;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 12px;
        color: #666;
        text-align: center;
      }

      .branding-footer a {
        color: #666;
        text-decoration: none;
      }

      /* Notification Page Specific Styles */
      .notif-status-box {
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        background: #e0f7fa;
        border: 1px solid #b2ebf2;
      }
      .notif-status-box.denied {
        background: #ffebee;
        border: 1px solid #ffcdd2;
      }
      .notif-setting-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 0;
        border-bottom: 1px solid #eee;
      }
      .notif-setting-item:last-child {
        border-bottom: none;
      }
      .toggle-switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 24px;
      }
      .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }
      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: 0.4s;
        border-radius: 24px;
      }
      .slider:before {
        position: absolute;
        content: "";
        height: 16px;
        width: 16px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
      }
      input:checked + .slider {
        background-color: var(--accent);
      }
      input:checked + .slider:before {
        transform: translateX(26px);
      }
    </style>
  </head>
  <body>
    <div id="sidebar" class="sidebar">
      <div class="profile">
        <img
          id="profilePhoto"
          src="https://via.placeholder.com/40"
          alt="Profile"
          width="45"
          height="45"
          style="border-radius: 50%; object-fit: cover; cursor: pointer"
          onclick="document.getElementById('photoUpload').click()"
        />
        <h3 id="profileName">üë§ User</h3>
      </div>
      <input
        id="photoUpload"
        type="file"
        accept="image/*"
        style="display: none"
      />

      <button class="menu-btn" data-page="home">üè† Home</button>
      <button class="menu-btn" data-page="reminders">‚è∞ Reminders</button>
      <button class="menu-btn" data-page="notes">üìù Notes</button>
      <button class="menu-btn" data-page="budget">üí∞ Budget Tracker</button>
      <button class="menu-btn" data-page="Check">‚úí Check List</button>
      <button class="menu-btn" data-page="utilities">üõ†Ô∏è Utilities</button>
      <button class="menu-btn" data-page="other">üé≤ Other Apps</button>

      <div id="settingsContainer" style="margin-top: auto">
        <button id="settingsBtn" class="icon-btn" aria-expanded="false">
          ‚öôÔ∏è Settings ‚ñº
        </button>
        <div id="settingsPanel" class="settings-panel" aria-hidden="true">
          <button class="menu-btn" id="editNameBtn">‚úèÔ∏è Edit Name</button>
          <button class="icon-btn" id="darkModeBtn">üåô Dark Mode</button>

          <button
            class="menu-btn"
            data-page="notifications"
            id="notificationBtn"
          >
            üîî Notification Settings
          </button>

          <button class="menu-btn" data-page="terms">
            üí¢ Terms & Conditions
          </button>
          <button class="menu-btn" data-page="how">üßë‚Äçüè´ How to Use</button>
        </div>
      </div>
    </div>

    <div id="main" class="main">
      <button id="toggleBtn" class="toggle-btn">‚Æû</button>

      <div id="home" class="page">
        <h2>Home</h2>
        <div class="add-area">
          <button
            id="homeRemindersToggle"
            class="add-btn"
            aria-expanded="false"
          >
            ‚ö†Ô∏è REMINDERS <span class="arrow">‚ñº</span>
          </button>
          <div id="homeRemindersContainer" class="form"></div>
        </div>
        <div class="add-area">
          <button id="homeNotesToggle" class="add-btn" aria-expanded="false">
            üìù NOTES <span class="arrow">‚ñº</span>
          </button>
          <div id="homeNotesContainer" class="form" aria-hidden="true"></div>
        </div>
        <div class="add-area">
          <button id="homeBudgetsToggle" class="add-btn" aria-expanded="false">
            üí∞ BUDGET OVERVIEW <span class="arrow">‚ñº</span>
          </button>
          <div id="homeBudgetsContainer" class="form" aria-hidden="true"></div>
        </div>

        <div class="add-area">
          <button id="homeCheckToggle" class="add-btn" aria-expanded="false">
            ‚úí CHECK LIST <span class="arrow">‚ñº</span>
          </button>
          <div id="homeCheckContainer" class="form" aria-hidden="true"></div>
        </div>

        <div class="branding-footer">
          <a href="https://github.com/spydernet3" target="_blank"
            >By Spydernet</a
          >
        </div>
      </div>

      <div id="reminders" class="page hidden">
        <h2>Reminders</h2>
        <div class="add-area">
          <button id="showAddFormBtn" class="add-btn" aria-expanded="false">
            Ôºã ADD NEW REMINDER <span class="arrow">‚ñº</span>
          </button>
          <div id="reminderFormContainer" class="form" aria-hidden="true">
            <label
              >Title<input id="reminderTitle" type="text" placeholder="Title"
            /></label>
            <label>Start date<input id="startDate" type="date" /></label>
            <label>End date<input id="endDate" type="date" /></label>
            <div class="form-actions">
              <button id="saveReminderBtn" class="primary">Save</button>
              <button id="cancelReminderBtn" class="secondary">Cancel</button>
            </div>
          </div>
        </div>
        <div class="add-area">
          <button
            id="viewRemindersToggle"
            class="add-btn"
            aria-expanded="false"
          >
            üëÄ VIEW REMINDERS <span class="arrow">‚ñº</span>
          </button>
          <ul id="reminderList" class="list scrollable-list form"></ul>
        </div>
      </div>

      <div id="notes" class="page hidden">
        <h2>üìù Notes</h2>
        <div class="add-area">
          <button id="showAddNoteBtn" class="add-btn" aria-expanded="false">
            Ôºã ADD NEW NOTE <span class="arrow">‚ñº</span>
          </button>
          <div id="noteFormContainer" class="form" aria-hidden="true">
            <label>
              Attach File
              <input
                id="noteFile"
                type="file"
                accept="image/*,.pdf,.doc,.docx,.mp3,.mp4"
              />
            </label>

            <label>
              Note<textarea
                id="noteText"
                rows="4"
                placeholder="Write your note here..."
              ></textarea>
            </label>

            <label>
              Table Format<input type="checkbox" id="tableFormatCheckbox" />
              <span>Enable table format</span>
            </label>

            <div class="form-actions">
              <button id="saveNoteBtn" class="primary">Save</button>
              <button id="cancelNoteBtn" class="secondary">Cancel</button>
            </div>
          </div>
        </div>
        <div class="add-area">
          <button id="viewNotesToggle" class="add-btn" aria-expanded="false">
            üëÄ VIEW NOTES <span class="arrow">‚ñº</span>
          </button>
          <ul id="noteList" class="list scrollable-list form"></ul>
        </div>
      </div>

      <div id="budget" class="page hidden">
        <h2>üí∞ Budget Tracker</h2>
        <div class="add-area">
          <button id="showAddBudgetBtn" class="add-btn" aria-expanded="false">
            Ôºã CREATE NEW BUDGET <span class="arrow">‚ñº</span>
          </button>
          <div id="budgetFormContainer" class="form" aria-hidden="true">
            <label
              >Title<input
                id="budgetTitle"
                type="text"
                placeholder="Budget title"
            /></label>
            <label
              >Total Amount (‚Çπ)<input
                id="budgetAmount"
                type="number"
                placeholder="Total Amount"
            /></label>
            <label>Start Date<input id="budgetStartDate" type="date" /></label>
            <label>End Date<input id="budgetEndDate" type="date" /></label>
            <div class="form-actions">
              <button id="saveBudgetBtn" class="primary">Save</button>
              <button id="cancelBudgetBtn" class="secondary">Cancel</button>
            </div>
          </div>
        </div>
        <div class="add-area">
          <button id="viewbudgetToggle" class="add-btn" aria-expanded="false">
            üëÄ VIEW BUDGET OVERVIEW <span class="arrow">‚ñº</span>
          </button>
          <ul id="budgetList" class="list scrollable-list form"></ul>
        </div>
      </div>

      <div id="Check" class="page hidden">
        <h2>‚úí Check List</h2>
        <div class="add-area">
          <button id="showAddCheckBtn" class="add-btn" aria-expanded="false">
            Ôºã CREATE NEW CHECKLIST <span class="arrow">‚ñº</span>
          </button>
          <div id="checkFormContainer" class="form" aria-hidden="true">
            <label>
              Title<input
                id="checkTitle"
                type="text"
                placeholder="Checklist title"
              />
            </label>
            <label>
              Status<select id="checkStatus">
                <option value="open">Open</option>
                <option value="closed">Closed</option>
              </select>
            </label>
            <label>
              Items (one per line)<textarea
                id="checkItems"
                rows="4"
                placeholder="Item 1&#10;Item 2&#10;Item 3"
              ></textarea>
            </label>
            <div class="form-actions">
              <button id="saveCheckBtn" class="primary">Save</button>
              <button id="cancelCheckBtn" class="secondary">Cancel</button>
            </div>
          </div>
        </div>
        <div class="add-area">
          <button id="viewCheckToggle" class="add-btn" aria-expanded="false">
            üëÄ VIEW CHECKLISTS <span class="arrow">‚ñº</span>
          </button>
          <ul id="checkList" class="list scrollable-list form"></ul>
        </div>
      </div>

      <div id="notifications" class="page hidden">
        <h2>üîî Notification Settings</h2>

        <div id="globalNotifStatus" class="notif-status-box">
          <h3>Browser Permission</h3>
          <p id="browserPermissionText"></p>
          <button
            id="requestPermissionBtn"
            class="primary"
            style="margin-top: 10px"
          >
            Request / Check Permission
          </button>
        </div>

        <h3>Notification Categories</h3>
        <p style="font-size: 14px; opacity: 0.8">
          Note: Category notifications only work if the browser permission above
          is # Granted #.
        </p>

        <div class="notif-setting-item">
          <span>‚è∞ Reminder Page Reminders</span>
          <label class="toggle-switch">
            <input type="checkbox" id="toggleReminders" />
            <span class="slider"></span>
          </label>
        </div>

        <div class="notif-setting-item">
          <span>üìù Notes Reminders </span>
          <label class="toggle-switch">
            <input type="checkbox" id="toggleNotes" />
            <span class="slider"></span>
          </label>
        </div>

        <div class="notif-setting-item">
          <span>‚úí Checklist Reminders</span>
          <label class="toggle-switch">
            <input type="checkbox" id="toggleChecklist" />
            <span class="slider"></span>
          </label>
        </div>

        <div class="notif-setting-item">
          <span>üí∞ Budget Reminders</span>
          <label class="toggle-switch">
            <input type="checkbox" id="toggleBudget" />
            <span class="slider"></span>
          </label>
        </div>
      </div>

      <div id="terms" class="page hidden">
        <h1>Privacy Policy!</h1>
        <ul>
          <p>
            App data are stored using local storage. Avoid data losses before
            formatting the device.
          </p>
          <p>Maximum 500MB allowed to store user datas in local storage.</p>
          <p>
            Datas are synced as much as possible while page load after it depends
            on your browser behaviour
          </p>
          <p>
            Import & Export and Sharing datas are not allowed for security
            reasons
          </p>
          <p>
            Codes are carefully reviewed by ChatGPT and other AI Models Checkout
            Overall Rating in GitHub Readme file
          </p>
          <p>
            Would you like to contribute, check out here:
            <a href="https://github.com/spydernet3" target="_blank"
              >Spydernet Github ‚Ü†</a
            >
          </p>
        </ul>
        <hr />
        <h3>Version Info!</h3>
        <ul>
          <p>Version 13.4.6</p>
          <p>Last Updated: 24-Sep-2025</p>
          <p>Project Type: Open source</p>
        </ul>
      </div>

      <div id="how" class="page hidden">
        <h3>Install App</h3>
        <hr />
        <ul>
          <li>
            By Pressing Add to Home Screen Button There You can see Install App
            to install page as PWA
          </li>
        </ul>
        <h3>Reminder!</h3>
        <hr />
        <ul>
          <li>Go to the Reminders page</li>
          <li>Click + Add New Reminder</li>
          <li>Fill Title, Start Date, End Date</li>
          <li>Click Save</li>
          <li>Edit or delete using the ‚úèÔ∏è and üóëÔ∏è button.</li>
          <li>
            Today & Tomorrow Due reminders will appeared on the Home page
            automatically.
          </li>
        </ul>

        <h3>Notes!</h3>
        <hr />
        <ul>
          <li>Go to the Notes page.</li>
          <li>Click + Add New Note.</li>
          <li>Write your note in the textarea.</li>
          <li>It supports file formats (Images, pdf, audio, video, docs).</li>
          <li>Click Save. IST date & time are added automatically.</li>
          <li>Edit or delete using the ‚úèÔ∏è and üóëÔ∏è button.</li>
        </ul>

        <h3>Budget Tracker!</h3>
        <hr />
        <ul>
          <li>Go to the Budget Tracker page.</li>
          <li>Click + Add New Budget.</li>
          <li>That will showed Total Amount/Remaining Days</li>
          <li>That will shows Cost per day How much you need to spend</li>
          <li>
            At Budget reminder it reminders your spend limit hole day with 5 Mins
            Interval
          </li>
          <li>Edit or delete using the ‚úèÔ∏è and üóëÔ∏è button.</li>
        </ul>

        <h3>Profile!</h3>
        <hr />
        <ul>
          <li>Click the profile picture to upload a new image.</li>
          <li>Click Edit Name to update the username now under Settings.</li>
        </ul>
        <h3>Checklist!</h3>
        <hr />
        <ul>
          <li>Create checklist and set status either Open/Closed</li>
          <li>Opened checklist listed in Home screen</li>
        </ul>
        <h3>Dark Mode!</h3>
        <hr />
        <ul>
          <li>
            Open Settings (‚öôÔ∏è) in the sidebar, then click the üåô button to
            toggle dark mode.
          </li>
          <li>Dark mode preference is saved.</li>
        </ul>
        <h3>Notification!</h3>
        <hr />
        <ul>
          <li>Notification will showed once page is active</li>
          <li>You will Turn Notification On/Off</li>
          <li>You can customize notification as per your requirements</li>
        </ul>
        <h3>Offline Mode</h3>
        <hr />
        <ul>
          <li>
            Step: Download Source Code Zip File in your Device and Extract foder
            then Open index.html without internet in any broweser Note:
            notifications are not supposed to allowed
          </li>
        </ul>
      </div>

      <div id="utilities" class="page hidden">
        <h2>üõ†Ô∏è Utilities</h2>
        <div class="add-area">
          <button
            id="monthlyCalendarToggle"
            class="add-btn"
            aria-expanded="false"
          >
            üìÖ MONTHLY CALENDAR <span class="arrow">‚ñº</span>
          </button>
          <div id="monthlyCalendarContainer" class="form" aria-hidden="true">
            <div
              id="calendarDisplay"
              style="
                padding: 10px;
                border: 1px solid #ddd;
                border-radius: 6px;
              "
            >
              <div
                style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 10px;
                "
              >
                <button id="prevMonthBtn" class="secondary">‚óÄ</button>
                <h4 id="currentMonthYear"></h4>
                <button id="nextMonthBtn" class="secondary">‚ñ∂</button>
              </div>
              <div
                id="calendarGrid"
                style="
                  display: grid;
                  grid-template-columns: repeat(7, 1fr);
                  text-align: center;
                  font-size: 14px;
                "
              >
                <div>S</div>
                <div>M</div>
                <div>T</div>
                <div>W</div>
                <div>T</div>
                <div>F</div>
                <div>S</div>
              </div>
            </div>
          </div>
        </div>

        <div class="add-area">
          <button id="calculatorToggle" class="add-btn" aria-expanded="false">
            üßÆ CALCULATOR <span class="arrow">‚ñº</span>
          </button>
          <div id="calculatorContainer" class="form" aria-hidden="true">
            <label>
              Select Mode:
              <select id="calculatorMode">
                <option value="normal">Normal Calculator</option>
                <option value="age">Age Calculator</option>
                <option value="date">Date Difference Calculator</option>
                <option value="scientific" disabled>
                  Scientific Calculator (WIP)
                </option>
              </select>
            </label>
            <div id="normalCalculator" class="calculator-mode">
              <input
                type="text"
                id="normalDisplay"
                value="0"
                readonly
                style="
                  text-align: right;
                  font-size: 20px;
                  margin-bottom: 8px;
                "
              />
              <div
                style="
                  display: grid;
                  grid-template-columns: repeat(4, 1fr);
                  gap: 5px;
                "
              >
                <button
                  class="secondary normal-btn"
                  data-value="clear"
                  style="grid-column: span 2"
                >
                  C
                </button>
                <button class="secondary normal-btn" data-value="backspace">
                  ‚å´
                </button>
                <button class="secondary normal-btn" data-value="/">/</button>

                <button class="primary normal-btn" data-value="7">7</button>
                <button class="primary normal-btn" data-value="8">8</button>
                <button class="primary normal-btn" data-value="9">9</button>
                <button class="secondary normal-btn" data-value="*">*</button>

                <button class="primary normal-btn" data-value="4">4</button>
                <button class="primary normal-btn" data-value="5">5</button>
                <button class="primary normal-btn" data-value="6">6</button>
                <button class="secondary normal-btn" data-value="-">-</button>

                <button class="primary normal-btn" data-value="1">1</button>
                <button class="primary normal-btn" data-value="2">2</button>
                <button class="primary normal-btn" data-value="3">3</button>
                <button class="secondary normal-btn" data-value="+">+</button>

                <button
                  class="primary normal-btn"
                  data-value="."
                  style="font-weight: bold"
                >
                  .
                </button>
                <button class="primary normal-btn" data-value="0">0</button>
                <button
                  class="primary normal-btn"
                  data-value="equals"
                  style="grid-column: span 2; background: var(--accent)"
                >
                  = Save & Calc
                </button>
              </div>
            </div>
            <div id="ageCalculator" class="calculator-mode hidden">
              <label>Date of Birth <input type="date" id="dobInput" /></label>
              <label
                >As of Date <input type="date" id="asOfDateInput"
              /></label>
              <div class="form-actions">
                <button id="calculateAgeBtn" class="primary">
                  Calculate Age
                </button>
              </div>
              <p
                id="ageResult"
                style="margin-top: 10px; font-weight: 600"
              ></p>
            </div>
            <div id="dateCalculator" class="calculator-mode hidden">
              <label
                >Start Date <input type="date" id="dateDiffStart"
              /></label>
              <label>End Date <input type="date" id="dateDiffEnd" /></label>
              <div class="form-actions">
                <button id="calculateDateDiffBtn" class="primary">
                  Calculate Difference
                </button>
              </div>
              <p
                id="dateDiffResult"
                style="margin-top: 10px; font-weight: 600"
              ></p>
            </div>
          </div>
        </div>

        <div class="add-area">
          <button id="viewHistoryToggle" class="add-btn" aria-expanded="false">
            ‚è≥ VIEW HISTORY <span class="arrow">‚ñº</span>
          </button>
          <ul
            id="calculationHistoryList"
            class="list scrollable-list form"
            aria-hidden="true"
          ></ul>
        </div>
      </div>

      <div id="other" class="page hidden">
        <h2>üé≤ Other Apps</h2>
        <div
          style="
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
          "
        >
          <a
            href="https://you-tube-seven.vercel.app/"
            target="_blank"
            style="text-decoration: none; color: inherit"
          >
            <button class="menu-btn" style="width: 180px">
              YouTube Filter
            </button>
          </a>
          <a
            href="https://spydernet3.github.io/QR-Generator/"
            target="_blank"
            style="text-decoration: none; color: inherit"
          >
            <button class="menu-btn" style="width: 180px">QR Generator</button>
          </a>
          <a
            href="https://spydernet3.github.io/multi_website_browser/"
            target="_blank"
            style="text-decoration: none; color: inherit"
          >
            <button class="menu-btn" style="width: 180px">
              Multi Website Browser
            </button>
          </a>
          <a
            href="https://spydernet3.github.io/Battery_Health_Monitor/"
            target="_blank"
            style="text-decoration: none; color: inherit"
          >
            <button class="menu-btn" style="width: 180px">
              Battery Health Monitor
            </button>
          </a>
          <a
            href="https://spydernet3.github.io/farewell/"
            target="_blank"
            style="text-decoration: none; color: inherit"
          >
            <button class="menu-btn" style="width: 180px">
              Farewell Wishes
            </button>
          </a>
          <a
            href="https://spydernet3.github.io/live-audio-transcrib/"
            target="_blank"
            style="text-decoration: none; color: inherit"
          >
            <button class="menu-btn" style="width: 180px">Email Alert</button>
          </a>
          <a
            href="https://github.com/spydernet3/Text-messaging-alert"
            target="_blank"
            style="text-decoration: none; color: inherit"
          >
            <button class="menu-btn" style="width: 180px">SmS Alert</button>
          </button>
          <a
            href="https://spydernet3.github.io/live-audio-transcrib/"
            target="_blank"
            style="text-decoration: none; color: inherit"
          >
            <button class="menu-btn" style="width: 180px">
              Live Audio Transcrib
            </button>
          </a>
          <a
            href="https://spydernet3.github.io/Notepad/"
            target="_blank"
            style="text-decoration: none; color: inherit"
          >
            <button class="menu-btn" style="width: 180px">Notepad</button>
          </a>
          <a
            href="https://spydernet3.github.io/Smart-Card/"
            target="_blank"
            style="text-decoration: none; color: inherit"
          >
            <button class="menu-btn" style="width: 180px">Smart Card</button>
          </a>
        </div>
      </div>
    </div>

    <script>
      // Service Worker Registration - CONSOLIDATED AND CLEANED UP
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('service-worker.js')
            .then((registration) => {
              console.log('SW registered successfully:', registration);
            })
            .catch((error) => {
              console.error('SW registration failed. Ensure service-worker.js is in the root directory:', error);
            });
        });
      }

      (function () {
        // ---------- Helpers ----------
        function byId(id) {
          return document.getElementById(id);
        }

        // ---------- NEW: Notification Settings Logic ----------
        function updateBrowserPermissionUI() {
          const status = Notification.permission;
          const textEl = byId('browserPermissionText');
          const boxEl = byId('globalNotifStatus');
          const btnEl = byId('requestPermissionBtn');

          boxEl.classList.remove('denied');

          if (status === 'granted') {
            textEl.innerHTML =
              'Status: <b style="color: var(--accent);">Granted (ON)</b>';
            btnEl.textContent = 'Permission Granted';
            btnEl.disabled = true;
          } else if (status === 'denied') {
            textEl.innerHTML =
              'Status: <b style="color: #f44336;">Denied (OFF)</b>. Please change in browser settings.';
            btnEl.textContent = 'Permission Denied';
            btnEl.disabled = true;
            boxEl.classList.add('denied');
          } else {
            // 'default' or not supported
            textEl.innerHTML =
              'Status: <b style="color: #ff9800;">Not Requested (OFF)</b>';
            btnEl.textContent = 'Request Permission';
            btnEl.disabled = false;
          }
        }

        function requestNotificationPermission() {
          if (!('Notification' in window)) {
            console.error('This browser does not support desktop notification');
            return;
          }
          if (
            Notification.permission === 'granted' ||
            Notification.permission === 'denied'
          ) {
            updateBrowserPermissionUI();
            return;
          }

          Notification.requestPermission().then(function (permission) {
            updateBrowserPermissionUI();
          });
        }

        function renderNotificationPage() {
          if (!('Notification' in window)) {
            byId('globalNotifStatus').innerHTML =
              '<h3>Browser Permission</h3><p style="color: #f44336;">Notifications are not supported by your browser.</p>';
            return;
          }

          updateBrowserPermissionUI();

          // Setup custom category toggles based on appData
          byId('toggleReminders').checked = appData.notifReminders;
          byId('toggleNotes').checked = appData.notifNotes;
          byId('toggleChecklist').checked = appData.notifChecklist;
          byId('toggleBudget').checked = appData.notifBudget;
        }

        // Function to handle custom toggle changes
        function handleCustomNotifToggle(category, event) {
          appData[category] = event.target.checked;
          saveAll();
          // Re-check notifications immediately if a new category is toggled on
          if (event.target.checked) checkNotifications();
        }

        // ---------- NEW: CORE NOTIFICATION DISPLAY LOGIC (FIX FOR ANDROID) ----------
        async function checkNotifications() {
          if (Notification.permission !== 'granted') return;

          const registration = await navigator.serviceWorker.getRegistration();
          if (!registration) {
            console.warn('Service Worker not registered. Cannot show persistent notifications.');
            return;
          }

          const now = new Date();
          const todayStr = now.toISOString().split('T')[0];
          const tomorrow = new Date(now);
          tomorrow.setDate(now.getDate() + 1);
          const tomorrowStr = tomorrow.toISOString().split('T')[0];

          let notifsToShow = [];

          // 1. Reminders (Due Today or Tomorrow, or Expired)
          if (appData.notifReminders) {
            appData.reminders.forEach((r) => {
              const diff = daysLeft(r.endDate);
              if (diff <= 1) {
                // Today, Tomorrow, or Expired
                const title = `‚ö†Ô∏è Reminder Due!`;
                const options = {
                  body: `"${r.title}" is due ${diff === 0 ? 'TODAY' : diff === 1 ? 'tomorrow' : 'and has expired'}.`,
                  icon: 'assets/icon.png',
                  badge: 'assets/icon.png',
                  tag: `reminder-${r.title}-${r.endDate}`,
                };
                notifsToShow.push({ title, options });
              }
            });
          }

          // 2. Open Checklists
          if (appData.notifChecklist) {
            const openChecklists = appData.checklists.filter(c => c.status === 'open');
            if (openChecklists.length > 0) {
              const title = `‚úíÔ∏è Open Checklists (${openChecklists.length})`;
              const options = {
                body: `You have ${openChecklists.length} checklists that are still open. Time to check them off!`,
                icon: 'assets/icon.png',
                badge: 'assets/icon.png',
                tag: 'open-checklists',
              };
              notifsToShow.push({ title, options });
            }
          }

          // 3. Budget (Simple reminder for budget period end date)
          if (appData.notifBudget) {
            appData.budget.forEach((b) => {
              const diff = daysLeft(b.endDate);
              if (diff === 0) {
                const costPerDay = calculateCostPerDay(b.amount, b.startDate, b.endDate);
                const title = `üí∞ Budget "${b.title}" Ends TODAY!`;
                const options = {
                  body: `Your budget period ends today. Daily spending limit was ‚Çπ${costPerDay}.`,
                  icon: 'assets/icon.png',
                  badge: 'assets/icon.png',
                  tag: `budget-end-${b.title}`,
                };
                notifsToShow.push({ title, options });
              }
            });
          }

          // 4. Notes (Simple reminder for note creation, not implemented a date field for notes yet)
          if (appData.notifNotes) {
            // Placeholder: Could add logic if notes had a 'remindDate' field.
          }

          // Show all unique notifications via Service Worker
          for (const notif of notifsToShow) {
            // Using showNotification via registration ensures it works in background/PWA on Android
            registration.showNotification(notif.title, notif.options);
          }
        }
        // ---------- END NEW BLOCK ----------

        // ---------- Storage ----------

        // Enhanced storage with quota handling
        const STORAGE_KEY = 'smart_reminder_app_v1';

        const defaultData = {
          reminders: [],
          notes: [],
          profileName: '',
          profilePhoto: '',
          darkMode: '0',
          budget: [],
          checklists: [],
          // NEW: Notification preferences
          notifReminders: true,
          notifNotes: true,
          notifChecklist: true,
          notifBudget: true,
          // NEW: Calculation History
          calculationHistory: [],
        };

        let appData =
          JSON.parse(localStorage.getItem(STORAGE_KEY)) || defaultData;
        // Merge with defaults to ensure new notif keys are present on load
        appData = { ...defaultData, ...appData };
        // Ensure new property is initialized if old data exists
        if (!appData.calculationHistory) appData.calculationHistory = [];

        let editingIndex = null;
        let editingBudgetIndex = null;
        let editingCheckIndex = null;
        let editingNoteIndex = null;
        let editingHistoryIndex = null; // NEW: for history editing

        let currentMonth = new Date().getMonth(); // NEW: Calendar state
        let currentYear = new Date().getFullYear(); // NEW: Calendar state
        // ... rest of the script ...

        // Modified save function to use localStorage only
        async function saveAll() {
          try {
            const dataStr = JSON.stringify(appData);
            localStorage.setItem(STORAGE_KEY, dataStr);
            console.log('Data saved successfully to localStorage.');
            // Re-render the notification page whenever data changes
            renderNotificationPage();
            // NOTIFICATION CHANGE: Trigger notification check on every data save.
            await checkNotifications();
          } catch (err) {
            console.error('Save failed:', err);
            if (err.name === 'QuotaExceededError') {
              console.error(
                'Storage is full. Please delete some data to make space.'
              );
            }
          }
        }

        function daysLeft(endDateStr) {
          if (!endDateStr) return null;
          const [y, m, d] = endDateStr.split('-').map(Number);
          const end = new Date(y, m - 1, d);
          const now = new Date();
          const diffTime = end.setHours(0, 0, 0, 0) - now.setHours(0, 0, 0, 0);
          return Math.floor(diffTime / (1000 * 60 * 60 * 24));
        }

        function formatDMY(dateStr) {
          if (!dateStr) return '';
          const [y, m, d] = dateStr.split('-');
          return `${d.toString().padStart(2, '0')}/${m
            .toString()
            .padStart(2, '0')}/${y}`;
        }

        // Format date as DD-MMM-YYYY with IST time (12-hour format)
        function formatDateDMYWithTime(date) {
          const months = [
            'Jan',
            'Feb',
            'Mar',
            'Apr',
            'May',
            'Jun',
            'Jul',
            'Aug',
            'Sep',
            'Oct',
            'Nov',
            'Dec',
          ];
          const day = date.getDate().toString().padStart(2, '0');
          const month = months[date.getMonth()];
          const year = date.getFullYear();
          // Get IST time (UTC+5:30)
          const istHours = date.getHours();
          const istMinutes = date.getMinutes().toString().padStart(2, '0');
          const ampm = istHours >= 12 ? 'PM' : 'AM';
          const displayHours = istHours % 12 || 12;
          return `${day}-${month}-${year} ${displayHours}:${istMinutes} ${ampm}`;
        }

        // Calculate days between two dates
        function daysBetween(startDateStr, endDateStr) {
          if (!startDateStr || !endDateStr) return 0;
          const [startY, startM, startD] = startDateStr.split('-').map(Number);
          const [endY, endM, endD] = endDateStr.split('-').map(Number);
          const start = new Date(startY, startM - 1, startD);
          const end = new Date(endY, endM - 1, endD);
          const diffTime = end.setHours(0, 0, 0, 0) - start.setHours(0, 0, 0, 0);
          return Math.floor(diffTime / (1000 * 60 * 60 * 24)) + 1; // +1 to include both start and end dates
        }

        // Calculate cost per day
        function calculateCostPerDay(amount, startDate, endDate) {
          const days = daysBetween(startDate, endDate);
          if (days <= 0 || amount <= 0) return 0;
          return (amount / days).toFixed(2);
        }

        function renderReminders() {
          const list = byId('reminderList');
          list.innerHTML = '';
          if (appData.reminders.length === 0) {
            const li = document.createElement('li');
            li.textContent = 'No reminders yet.';
            li.style.opacity = '0.7';
            list.appendChild(li);
            renderHomeReminders();
            renderHomeNotes();
            renderHomeCheck();
            return;
          }
          const frag = document.createDocumentFragment();
          appData.reminders.forEach((r, i) => {
            const li = document.createElement('li');
            const left = document.createElement('div');
            left.className = 'item-left';
            const title = document.createElement('div');
            title.textContent = r.title;
            title.style.fontWeight = '600';
            const dates = document.createElement('div');
            dates.style.fontSize = '13px';
            dates.style.opacity = '0.85';
            dates.textContent = `Start: ${formatDMY(r.startDate)} | End: ${formatDMY(
              r.endDate
            )}`;
            left.appendChild(title);
            left.appendChild(dates);
            const right = document.createElement('div');
            right.style.display = 'flex';
            right.style.alignItems = 'center';
            const badge = document.createElement('div');
            badge.className = 'badge';
            const diff = daysLeft(r.endDate);
            if (diff === null) {
              badge.textContent = 'No date';
            } else if (diff < 0) {
              badge.textContent = 'Expired';
            } else if (diff === 0) {
              badge.textContent = 'Today';
            } else {
              badge.textContent = `${diff} days left`;
            }
            const editBtn = document.createElement('button');
            editBtn.className = 'icon-small';
            editBtn.textContent = '‚úèÔ∏è';
            editBtn.title = 'Edit';
            editBtn.addEventListener('click', () => editReminder(i));
            const delBtn = document.createElement('button');
            delBtn.className = 'icon-small';
            delBtn.textContent = 'üóëÔ∏è';
            delBtn.title = 'Delete';
            delBtn.addEventListener('click', () => deleteReminder(i));
            right.appendChild(badge);
            right.appendChild(editBtn);
            right.appendChild(delBtn);
            li.appendChild(left);
            li.appendChild(right);
            frag.appendChild(li);
          });
          list.appendChild(frag);
          renderHomeReminders();
          renderHomeNotes();
          renderHomeCheck();
        }

        function renderHomeReminders() {
          const container = byId('homeRemindersContainer');
          container.innerHTML = '';
          // Filter reminders to show only today and 1 day left
          const filteredReminders = appData.reminders.filter((r) => {
            const diff = daysLeft(r.endDate);
            return diff === 0 || diff === 1 || diff < 0;
          });
          if (filteredReminders.length === 0) {
            const li = document.createElement('li');
            li.textContent = 'No reminders for today or tomorrow.';
            li.style.opacity = '0.7';
            container.appendChild(li);
            return;
          }
          const frag = document.createDocumentFragment();
          filteredReminders.forEach((r) => {
            const li = document.createElement('li');
            const diff = daysLeft(r.endDate);
            let badgeText = '';
            if (diff === null) {
              badgeText = 'No date';
            } else if (diff < 0) {
              badgeText = 'Expired';
            } else if (diff === 0) {
              badgeText = 'Today';
            } else {
              badgeText = `${diff} days left`;
            }
            li.textContent = `"${r.title}" || ${badgeText}`;
            frag.appendChild(li);
          });
          container.appendChild(frag);
        }

        // Update renderHomeNotes function to handle table formatting
        function renderHomeNotes() {
          const container = byId('homeNotesContainer');
          container.innerHTML = '';
          if (appData.notes.length === 0) {
            const li = document.createElement('li');
            li.textContent = 'No notes available.';
            li.style.opacity = '0.7';
            container.appendChild(li);
            return;
          }
          const frag = document.createDocumentFragment();
          appData.notes.forEach((n) => {
            const li = document.createElement('li');
            li.className = 'list-item';
            const left = document.createElement('div');
            left.className = 'item-left';
            // Main Text/Table Content
            const text = document.createElement('div');
            if (n.isTable && n.text) {
              // Show first few rows of table in home view
              const lines = n.text.split('\n');
              let tableHTML =
                '<table border="1" style="border-collapse: collapse; width: 100%;">';
              lines.forEach((line, index) => {
                if (line.includes('---')) {
                  if (index > 0) tableHTML += '</tr>';
                  tableHTML += '<tr>';
                } else if (line.includes('|')) {
                  const cells = line
                    .split('|')
                    .filter((cell) => cell.trim() !== '');
                  cells.forEach((cell) => {
                    const cellContent = cell.trim();
                    if (index === 0) {
                      tableHTML += `<th style="border: 1px solid #ddd; padding: 4px;">${cellContent}</th>`;
                    } else {
                      tableHTML += `<td style="border: 1px solid #ddd; padding: 4px;">${cellContent}</td>`;
                    }
                  });
                }
              });
              tableHTML += '</tr></table>';
              text.innerHTML = tableHTML;
            } else {
              text.innerHTML = `<b>${(n.text || '').substring(
                0,
                50
              )}...</b><br><small style="opacity:0.7">${
                n.createdAt || ''
              }</small>`;
            }
            left.appendChild(text);
            // File Thumbnail Display - EXISTING, KEPT
            if (n.file && n.file.type && n.file.type.includes('image')) {
              const thumb = document.createElement('img');
              thumb.src = n.file.data;
              thumb.style.maxWidth = '40px';
              thumb.style.marginLeft = '5px';
              thumb.style.borderRadius = '4px';
              thumb.style.verticalAlign = 'middle';
              thumb.alt = n.file.name || 'image';
              left.appendChild(thumb);
            }
            li.appendChild(left);
            frag.appendChild(li);
          });
          container.appendChild(frag);
        }

        // Update renderNotes function to handle table formatting
        function renderNotes() {
          const list = byId('noteList');
          list.innerHTML = '';
          if (appData.notes.length === 0) {
            const li = document.createElement('li');
            li.textContent = 'No notes yet.';
            li.style.opacity = '0.7';
            list.appendChild(li);
            return;
          }
          const frag = document.createDocumentFragment();
          appData.notes.forEach((note, i) => {
            const li = document.createElement('li');
            const left = document.createElement('div');
            left.className = 'item-left';
            const text = document.createElement('div');
            if (note.isTable && note.text) {
              // Convert table format to HTML table
              const lines = note.text.split('\n');
              let tableHTML =
                '<table border="1" style="border-collapse: collapse; width: 100%;">';
              lines.forEach((line, index) => {
                if (line.includes('---')) {
                  // Row separator - add closing tags for previous row
                  if (index > 0) tableHTML += '</tr>';
                  tableHTML += '<tr>';
                } else if (line.includes('|')) {
                  // Table row
                  const cells = line
                    .split('|')
                    .filter((cell) => cell.trim() !== '');
                  cells.forEach((cell) => {
                    const cellContent = cell.trim();
                    if (index === 0) {
                      tableHTML += `<th style="border: 1px solid #ddd; padding: 8px;">${cellContent}</th>`;
                    } else {
                      tableHTML += `<td style="border: 1px solid #ddd; padding: 8px;">${cellContent}</td>`;
                    }
                  });
                }
              });
              tableHTML += '</tr></table>';
              text.innerHTML = tableHTML;
            } else {
              text.innerHTML = `<b>${(note.text || '').substring(
                0,
                200
              )}...</b><br><small style="opacity:0.7">${
                note.createdAt || ''
              }</small>`;
            }
            left.appendChild(text);

            const right = document.createElement('div');
            right.style.display = 'flex';
            right.style.alignItems = 'center';

            // File Link/Thumbnail Display
            if (note.file && note.file.data) {
              const fileType = note.file.type || '';
              const fileName = note.file.name || 'Attached File';
              const fileLink = document.createElement('a');
              fileLink.href = note.file.data;
              fileLink.download = fileName; // Allows downloading the data URL
              fileLink.target = '_blank';
              fileLink.style.marginRight = '8px';
              fileLink.style.fontSize = '14px';

              if (fileType.includes('image')) {
                const thumb = document.createElement('img');
                thumb.src = note.file.data;
                thumb.style.maxWidth = '30px';
                thumb.style.maxHeight = '30px';
                thumb.style.borderRadius = '4px';
                thumb.alt = 'Image';
                fileLink.appendChild(thumb);
              } else {
                fileLink.textContent = `[üìÑ ${fileName}]`;
              }
              right.appendChild(fileLink);
            }

            const editBtn = document.createElement('button');
            editBtn.className = 'icon-small';
            editBtn.textContent = '‚úèÔ∏è';
            editBtn.title = 'Edit';
            editBtn.addEventListener('click', () => editNote(i));
            const delBtn = document.createElement('button');
            delBtn.className = 'icon-small';
            delBtn.textContent = 'üóëÔ∏è';
            delBtn.title = 'Delete';
            delBtn.addEventListener('click', () => deleteNote(i));

            right.appendChild(editBtn);
            right.appendChild(delBtn);

            li.appendChild(left);
            li.appendChild(right);
            frag.appendChild(li);
          });
          list.appendChild(frag);
        }

        function renderBudgets() {
          const list = byId('budgetList');
          list.innerHTML = '';
          if (appData.budget.length === 0) {
            const li = document.createElement('li');
            li.textContent = 'No budgets yet.';
            li.style.opacity = '0.7';
            list.appendChild(li);
            return;
          }
          const frag = document.createDocumentFragment();
          appData.budget.forEach((b, i) => {
            const li = document.createElement('li');
            const left = document.createElement('div');
            left.className = 'item-left';
            const title = document.createElement('div');
            title.textContent = b.title;
            title.style.fontWeight = '600';
            const dates = document.createElement('div');
            dates.style.fontSize = '13px';
            dates.style.opacity = '0.85';
            dates.textContent = `Start: ${formatDMY(b.startDate)} | End: ${formatDMY(
              b.endDate
            )}`;
            left.appendChild(title);
            left.appendChild(dates);

            const right = document.createElement('div');
            right.style.display = 'flex';
            right.style.alignItems = 'center';

            const diff = daysLeft(b.endDate);
            const days = daysBetween(b.startDate, b.endDate);
            const costPerDay = calculateCostPerDay(b.amount, b.startDate, b.endDate);

            const badge = document.createElement('div');
            badge.className = 'badge';
            if (diff === null || days <= 0) {
              badge.textContent = 'Invalid Date';
            } else if (diff < 0) {
              badge.textContent = 'Period Ended';
              badge.style.background = '#f44336';
              badge.style.color = '#fff';
            } else {
              badge.textContent = `‚Çπ${b.amount} / ${diff} days left`;
              badge.style.background = '#4CAF50';
              badge.style.color = '#fff';
            }

            const dailyCost = document.createElement('div');
            dailyCost.style.fontSize = '12px';
            dailyCost.style.opacity = '0.7';
            dailyCost.textContent = `Daily Max: ‚Çπ${costPerDay}`;

            const costContainer = document.createElement('div');
            costContainer.style.textAlign = 'right';
            costContainer.style.marginRight = '8px';
            costContainer.appendChild(badge);
            costContainer.appendChild(dailyCost);

            const editBtn = document.createElement('button');
            editBtn.className = 'icon-small';
            editBtn.textContent = '‚úèÔ∏è';
            editBtn.title = 'Edit';
            editBtn.addEventListener('click', () => editBudget(i));
            const delBtn = document.createElement('button');
            delBtn.className = 'icon-small';
            delBtn.textContent = 'üóëÔ∏è';
            delBtn.title = 'Delete';
            delBtn.addEventListener('click', () => deleteBudget(i));

            right.appendChild(costContainer);
            right.appendChild(editBtn);
            right.appendChild(delBtn);

            li.appendChild(left);
            li.appendChild(right);
            frag.appendChild(li);
          });
          list.appendChild(frag);
          renderHomeBudgets();
        }

        function renderHomeBudgets() {
          const container = byId('homeBudgetsContainer');
          container.innerHTML = '';
          if (appData.budget.length === 0) {
            const li = document.createElement('li');
            li.textContent = 'No budget overview available.';
            li.style.opacity = '0.7';
            container.appendChild(li);
            return;
          }
          const frag = document.createDocumentFragment();
          appData.budget.forEach((b) => {
            const li = document.createElement('li');
            const diff = daysLeft(b.endDate);
            const costPerDay = calculateCostPerDay(b.amount, b.startDate, b.endDate);
            let summary = '';
            let statusStyle = '';

            if (diff === null || daysBetween(b.startDate, b.endDate) <= 0) {
              summary = `"${b.title}" - Invalid Date Range`;
              statusStyle = 'color: #ff9800;';
            } else if (diff < 0) {
              summary = `"${b.title}" - Period Ended (Total: ‚Çπ${b.amount})`;
              statusStyle = 'color: #f44336;';
            } else {
              summary = `"${b.title}": ‚Çπ${b.amount} / ${diff} days left. Daily max: ‚Çπ${costPerDay}`;
              statusStyle = 'color: var(--text);';
            }

            li.innerHTML = `<span style="${statusStyle}">${summary}</span>`;
            frag.appendChild(li);
          });
          container.appendChild(frag);
        }

        function renderChecklists() {
          const list = byId('checkList');
          list.innerHTML = '';
          if (appData.checklists.length === 0) {
            const li = document.createElement('li');
            li.textContent = 'No checklists yet.';
            li.style.opacity = '0.7';
            list.appendChild(li);
            return;
          }
          const frag = document.createDocumentFragment();
          appData.checklists.forEach((c, i) => {
            const li = document.createElement('li');
            const left = document.createElement('div');
            left.className = 'item-left';
            const title = document.createElement('div');
            title.textContent = c.title;
            title.style.fontWeight = '600';
            const status = document.createElement('div');
            status.style.fontSize = '13px';
            status.style.opacity = '0.85';
            status.innerHTML = `Status: <span style="font-weight: bold; color: ${
              c.status === 'open' ? '#007bff' : '#4CAF50'
            }">${c.status.toUpperCase()}</span>`;
            left.appendChild(title);
            left.appendChild(status);

            const right = document.createElement('div');
            right.style.display = 'flex';
            right.style.alignItems = 'center';

            const toggleBtn = document.createElement('button');
            toggleBtn.className = 'status-btn';
            toggleBtn.textContent =
              c.status === 'open' ? 'Mark Closed' : 'Mark Open';
            toggleBtn.style.background = c.status === 'open' ? '#007bff' : '#4CAF50';
            toggleBtn.addEventListener('click', () => toggleChecklistStatus(i));

            const editBtn = document.createElement('button');
            editBtn.className = 'icon-small';
            editBtn.textContent = '‚úèÔ∏è';
            editBtn.title = 'Edit';
            editBtn.addEventListener('click', () => editChecklist(i));
            const delBtn = document.createElement('button');
            delBtn.className = 'icon-small';
            delBtn.textContent = 'üóëÔ∏è';
            delBtn.title = 'Delete';
            delBtn.addEventListener('click', () => deleteChecklist(i));

            right.appendChild(toggleBtn);
            right.appendChild(editBtn);
            right.appendChild(delBtn);

            li.appendChild(left);
            li.appendChild(right);
            frag.appendChild(li);
          });
          list.appendChild(frag);
          renderHomeCheck();
        }

        function renderHomeCheck() {
          const container = byId('homeCheckContainer');
          container.innerHTML = '';
          const openChecklists = appData.checklists.filter(
            (c) => c.status === 'open'
          );

          if (openChecklists.length === 0) {
            const li = document.createElement('li');
            li.textContent = 'All checklists are closed! Good job.';
            li.style.opacity = '0.7';
            container.appendChild(li);
            return;
          }

          const frag = document.createDocumentFragment();
          openChecklists.forEach((c) => {
            const li = document.createElement('li');
            
            // --- FIX APPLIED HERE ---
            // Ensure c.items is a string before calling split. 
            // If it's an array/object from corrupted storage, it's forced to an empty string.
            const itemsString = String(c.items || ''); 
            const itemCount = itemsString.split('\n').filter((item) => item.trim()).length;
            // --- END FIX ---
            
            li.textContent = `‚úíÔ∏è ${c.title} (${itemCount} items)`;
            frag.appendChild(li);
          });
          container.appendChild(frag);
        }

        // --- CRUD Implementation (Shortened for brevity but kept in order) ---

        // Reminder CRUD (Placeholders to prevent errors)
        function saveReminder() {
          // Placeholder implementation
          const title = byId('reminderTitle').value;
          const startDate = byId('startDate').value;
          const endDate = byId('endDate').value;
          if (title && startDate && endDate) {
            const newReminder = { title, startDate, endDate };
            if (editingIndex !== null) {
              appData.reminders[editingIndex] = newReminder;
              editingIndex = null;
            } else {
              appData.reminders.push(newReminder);
            }
            saveAll();
            renderReminders();
            byId('reminderTitle').value = '';
            byId('startDate').value = '';
            byId('endDate').value = '';
            toggleForm(byId('showAddFormBtn'), byId('reminderFormContainer')); // Hide form
          } else {
            alert('Please fill all reminder fields.');
          }
        }
        function editReminder(index) {
          // Placeholder implementation
          editingIndex = index;
          const r = appData.reminders[index];
          byId('reminderTitle').value = r.title;
          byId('startDate').value = r.startDate;
          byId('endDate').value = r.endDate;
          const btn = byId('showAddFormBtn');
          const form = byId('reminderFormContainer');
          if (!form.classList.contains('visible')) {
            toggleForm(btn, form);
          }
        }
        function deleteReminder(index) {
          // Placeholder implementation
          if (confirm('Are you sure you want to delete this reminder?')) {
            appData.reminders.splice(index, 1);
            saveAll();
            renderReminders();
          }
        }

        // Note CRUD (Placeholders to prevent errors)
        function saveNote() {
          // Placeholder implementation
          const noteText = byId('noteText').value;
          const isTable = byId('tableFormatCheckbox').checked;
          const now = formatDateDMYWithTime(new Date());

          if (noteText) {
            let noteData = {
              text: noteText,
              createdAt: now,
              isTable: isTable,
              file: null, // File handling simplified
            };
            if (editingNoteIndex !== null) {
              appData.notes[editingNoteIndex] = noteData;
              editingNoteIndex = null;
            } else {
              appData.notes.unshift(noteData);
            }
            saveAll();
            renderNotes();
            byId('noteText').value = '';
            byId('tableFormatCheckbox').checked = false;
            toggleForm(byId('showAddNoteBtn'), byId('noteFormContainer'));
          } else {
            alert('Please write a note.');
          }
        }
        function editNote(index) {
          // Placeholder implementation
          editingNoteIndex = index;
          const n = appData.notes[index];
          byId('noteText').value = n.text;
          byId('tableFormatCheckbox').checked = n.isTable;
          const btn = byId('showAddNoteBtn');
          const form = byId('noteFormContainer');
          if (!form.classList.contains('visible')) {
            toggleForm(btn, form);
          }
        }
        function deleteNote(index) {
          // Placeholder implementation
          if (confirm('Are you sure you want to delete this note?')) {
            appData.notes.splice(index, 1);
            saveAll();
            renderNotes();
          }
        }

        // Budget CRUD (Placeholders to prevent errors)
        function saveBudget() {
          // Placeholder implementation
          const title = byId('budgetTitle').value;
          const amount = parseFloat(byId('budgetAmount').value);
          const startDate = byId('budgetStartDate').value;
          const endDate = byId('budgetEndDate').value;

          if (title && amount > 0 && startDate && endDate) {
            const newBudget = { title, amount, startDate, endDate };
            if (editingBudgetIndex !== null) {
              appData.budget[editingBudgetIndex] = newBudget;
              editingBudgetIndex = null;
            } else {
              appData.budget.push(newBudget);
            }
            saveAll();
            renderBudgets();
            byId('budgetTitle').value = '';
            byId('budgetAmount').value = '';
            byId('budgetStartDate').value = '';
            byId('budgetEndDate').value = '';
            toggleForm(byId('showAddBudgetBtn'), byId('budgetFormContainer'));
          } else {
            alert('Please fill all budget fields correctly.');
          }
        }
        function editBudget(index) {
          // Placeholder implementation
          editingBudgetIndex = index;
          const b = appData.budget[index];
          byId('budgetTitle').value = b.title;
          byId('budgetAmount').value = b.amount;
          byId('budgetStartDate').value = b.startDate;
          byId('budgetEndDate').value = b.endDate;
          const btn = byId('showAddBudgetBtn');
          const form = byId('budgetFormContainer');
          if (!form.classList.contains('visible')) {
            toggleForm(btn, form);
          }
        }
        function deleteBudget(index) {
          // Placeholder implementation
          if (confirm('Are you sure you want to delete this budget?')) {
            appData.budget.splice(index, 1);
            saveAll();
            renderBudgets();
          }
        }

        // Checklist CRUD (Placeholders to prevent errors)
        function saveChecklist() {
          // Placeholder implementation
          const title = byId('checkTitle').value;
          const status = byId('checkStatus').value;
          const items = byId('checkItems').value;

          if (title && items) {
            const newChecklist = { title, status, items };
            if (editingCheckIndex !== null) {
              appData.checklists[editingCheckIndex] = newChecklist;
              editingCheckIndex = null;
            } else {
              appData.checklists.push(newChecklist);
            }
            saveAll();
            renderChecklists();
            byId('checkTitle').value = '';
            byId('checkStatus').value = 'open';
            byId('checkItems').value = '';
            toggleForm(byId('showAddCheckBtn'), byId('checkFormContainer'));
          } else {
            alert('Please fill the checklist title and items.');
          }
        }
        function editChecklist(index) {
          // Placeholder implementation
          editingCheckIndex = index;
          const c = appData.checklists[index];
          byId('checkTitle').value = c.title;
          byId('checkStatus').value = c.status;
          byId('checkItems').value = c.items;
          const btn = byId('showAddCheckBtn');
          const form = byId('checkFormContainer');
          if (!form.classList.contains('visible')) {
            toggleForm(btn, form);
          }
        }
        function deleteChecklist(index) {
          // Placeholder implementation
          if (confirm('Are you sure you want to delete this checklist?')) {
            appData.checklists.splice(index, 1);
            saveAll();
            renderChecklists();
          }
        }
        function toggleChecklistStatus(index) {
          // Placeholder implementation
          const c = appData.checklists[index];
          c.status = c.status === 'open' ? 'closed' : 'open';
          saveAll();
          renderChecklists();
        }

        // Placeholder for functions assumed to be present
        function renderHistory() {}
        function switchCalculatorMode() {}
        function setupNavigation() {
          const main = byId('main');
          document.querySelectorAll('.menu-btn[data-page]').forEach(button => {
            button.addEventListener('click', (e) => {
              document.querySelectorAll('.page').forEach(page => {
                page.classList.add('hidden');
              });
              const pageId = e.target.getAttribute('data-page');
              byId(pageId).classList.remove('hidden');
              if (pageId === 'notifications') {
                renderNotificationPage();
              }
            });
          });
        }
        function setupSettings() {
          const settingsBtn = byId('settingsBtn');
          const settingsPanel = byId('settingsPanel');
          if (settingsBtn) {
            settingsBtn.addEventListener('click', () => {
              const isVisible = settingsPanel.classList.toggle('visible');
              settingsBtn.setAttribute('aria-expanded', isVisible);
              settingsPanel.setAttribute('aria-hidden', !isVisible);
              settingsBtn.textContent = isVisible ? '‚öôÔ∏è Settings ‚ñ≤' : '‚öôÔ∏è Settings ‚ñº';
            });
          }

          const darkModeBtn = byId('darkModeBtn');
          if (darkModeBtn) {
            darkModeBtn.addEventListener('click', () => {
              document.body.classList.toggle('dark');
              appData.darkMode = document.body.classList.contains('dark') ? '1' : '0';
              saveAll();
            });
          }

          const editNameBtn = byId('editNameBtn');
          if (editNameBtn) {
            editNameBtn.addEventListener('click', () => {
              const newName = prompt('Enter new profile name:', appData.profileName || 'üë§ User');
              if (newName !== null && newName.trim() !== '') {
                appData.profileName = newName.trim();
                byId('profileName').textContent = appData.profileName;
                saveAll();
              }
            });
          }
        }
        function setupProfile() {
          const photoUpload = byId('photoUpload');
          if (photoUpload) {
            photoUpload.addEventListener('change', (event) => {
              const file = event.target.files[0];
              if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                  appData.profilePhoto = e.target.result;
                  byId('profilePhoto').src = e.target.result;
                  saveAll();
                };
                reader.readAsDataURL(file);
              }
            });
          }
        }
        function setupCalendar() {
          // Simplified placeholder for calendar. Requires full implementation.
          // This function is kept minimal to avoid introducing new errors.
          if (!byId('currentMonthYear')) return;
          const updateCalendarDisplay = (month, year) => {
            byId('currentMonthYear').textContent = `${new Date(year, month).toLocaleString('default', { month: 'long' })} ${year}`;
            const grid = byId('calendarGrid');
            if(grid) grid.innerHTML = '<div>S</div><div>M</div><div>T</div><div>W</div><div>T</div><div>F</div><div>S</div>'; // Basic day headers
          };

          const prevMonthBtn = byId('prevMonthBtn');
          const nextMonthBtn = byId('nextMonthBtn');
          if (prevMonthBtn) prevMonthBtn.addEventListener('click', () => {
            currentMonth--;
            if (currentMonth < 0) {
              currentMonth = 11;
              currentYear--;
            }
            updateCalendarDisplay(currentMonth, currentYear);
          });
          if (nextMonthBtn) nextMonthBtn.addEventListener('click', () => {
            currentMonth++;
            if (currentMonth > 11) {
              currentMonth = 0;
              currentYear++;
            }
            updateCalendarDisplay(currentMonth, currentYear);
          });

          updateCalendarDisplay(currentMonth, currentYear);
        }
        function setupCalculator() {
          const modeSelector = byId('calculatorMode');
          if (modeSelector) {
            modeSelector.addEventListener('change', switchCalculatorMode);
          }
          if (byId('calculateAgeBtn')) byId('calculateAgeBtn').addEventListener('click', calculateAge);
          if (byId('calculateDateDiffBtn')) byId('calculateDateDiffBtn').addEventListener('click', calculateDateDifference);
          
          const normalDisplay = byId('normalDisplay');
          const normalCalculator = byId('normalCalculator');
          if (normalCalculator) {
              normalCalculator.addEventListener('click', (e) => {
                  if (e.target.tagName !== 'BUTTON') return;
                  const value = e.target.getAttribute('data-value');
                  if (!value) return;

                  if (value === 'clear') {
                      normalDisplay.value = '0';
                  } else if (value === 'backspace') {
                      normalDisplay.value = normalDisplay.value.slice(0, -1) || '0';
                  } else if (value === 'equals') {
                      try {
                          const result = eval(normalDisplay.value.replace(/[^0-9+\-*/.]/g, ''));
                          normalDisplay.value = result;
                          appData.calculationHistory.push({ expression: normalDisplay.value, result: result, timestamp: new Date().toISOString() });
                          saveAll();
                          renderHistory();
                      } catch (e) {
                          normalDisplay.value = 'Error';
                      }
                  } else if (['+', '-', '*', '/'].includes(value)) {
                      normalDisplay.value = normalDisplay.value === '0' ? '0' + value : normalDisplay.value + value;
                  } else {
                      normalDisplay.value = normalDisplay.value === '0' ? value : normalDisplay.value + value;
                  }
              });
          }
        }

        function calculateAge() {
            const dobInput = byId('dobInput').value;
            const asOfDateInput = byId('asOfDateInput').value || new Date().toISOString().split('T')[0];
            const dob = new Date(dobInput);
            const asOf = new Date(asOfDateInput);
            if (!dobInput) {
                byId('ageResult').textContent = 'Please enter a Date of Birth.';
                return;
            }
            if (dob > asOf) {
                byId('ageResult').textContent = 'Date of Birth cannot be after As of Date.';
                return;
            }

            let years = asOf.getFullYear() - dob.getFullYear();
            let months = asOf.getMonth() - dob.getMonth();
            let days = asOf.getDate() - dob.getDate();

            if (days < 0) {
                months--;
                days += new Date(asOf.getFullYear(), asOf.getMonth(), 0).getDate();
            }
            if (months < 0) {
                years--;
                months += 12;
            }
            
            const result = `${years} years, ${months} months, and ${days} days`;
            byId('ageResult').textContent = `Age: ${result}`;

            appData.calculationHistory.push({ expression: `Age of ${dobInput} as of ${asOfDateInput}`, result: result, timestamp: new Date().toISOString() });
            saveAll();
            renderHistory();
        }

        function calculateDateDifference() {
            const startDate = byId('dateDiffStart').value;
            const endDate = byId('dateDiffEnd').value;
            
            if (!startDate || !endDate) {
                byId('dateDiffResult').textContent = 'Please select both start and end dates.';
                return;
            }

            const start = new Date(startDate);
            const end = new Date(endDate);

            const diffTime = Math.abs(end - start);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
            
            const result = `${diffDays} days`;
            byId('dateDiffResult').textContent = `Difference: ${result}`;

            appData.calculationHistory.push({ expression: `Days between ${startDate} and ${endDate}`, result: result, timestamp: new Date().toISOString() });
            saveAll();
            renderHistory();
        }

        function switchCalculatorMode() {
          document.querySelectorAll('.calculator-mode').forEach(el => el.classList.add('hidden'));
          const selectedMode = byId('calculatorMode').value;
          byId(selectedMode + 'Calculator').classList.remove('hidden');
        }

        function toggleForm(btn, form) {
          form.classList.toggle('visible');
          form.setAttribute('aria-hidden', form.classList.contains('visible') ? 'false' : 'true');
          btn.classList.toggle('open');
          btn.setAttribute('aria-expanded', btn.classList.contains('open') ? 'true' : 'false');
        }
        
        // Function for opening/closing the sidebar and other toggles
        function setupUI() {
          const toggleBtn = byId('toggleBtn');
          const sidebar = byId('sidebar');
          const main = byId('main');

          function toggleSidebar() {
            const isVisible = sidebar.style.left !== '-220px';
            sidebar.style.left = isVisible ? '-220px' : '0';
            main.style.marginLeft = isVisible ? '20px' : '220px';
            toggleBtn.style.left = isVisible ? '0' : '210px';
            toggleBtn.textContent = isVisible ? '‚Æú' : '‚Æû'; // Change icon
          }

          if (toggleBtn) toggleBtn.addEventListener('click', toggleSidebar);

          // Setup toggle handlers for Home page sections
          const homeToggles = [
              { btnId: 'homeRemindersToggle', containerId: 'homeRemindersContainer' },
              { btnId: 'homeNotesToggle', containerId: 'homeNotesContainer' },
              { btnId: 'homeBudgetsToggle', containerId: 'homeBudgetsContainer' },
              { btnId: 'homeCheckToggle', containerId: 'homeCheckContainer' }
          ];

          homeToggles.forEach(({ btnId, containerId }) => {
              const btn = byId(btnId);
              const container = byId(containerId);
              if (btn && container) {
                  btn.addEventListener('click', () => toggleForm(btn, container));
              }
          });

          // Setup toggle handlers for View sections
          const viewToggles = [
              { btnId: 'viewRemindersToggle', containerId: 'reminderList' },
              { btnId: 'viewNotesToggle', containerId: 'noteList' },
              { btnId: 'viewbudgetToggle', containerId: 'budgetList' },
              { btnId: 'viewCheckToggle', containerId: 'checkList' },
              { btnId: 'monthlyCalendarToggle', containerId: 'monthlyCalendarContainer' },
              { btnId: 'calculatorToggle', containerId: 'calculatorContainer' },
              { btnId: 'viewHistoryToggle', containerId: 'calculationHistoryList' },
          ];

          viewToggles.forEach(({ btnId, containerId }) => {
              const btn = byId(btnId);
              const container = byId(containerId);
              if (btn && container) {
                  btn.addEventListener('click', () => toggleForm(btn, container));
              }
          });
        }
        function setupReminders() {
          const showAddFormBtn = byId('showAddFormBtn');
          const reminderFormContainer = byId('reminderFormContainer');
          // Add Toggle functionality
          if (showAddFormBtn) showAddFormBtn.addEventListener('click', toggleForm.bind(null, showAddFormBtn, reminderFormContainer));
          if (byId('saveReminderBtn')) byId('saveReminderBtn').addEventListener('click', saveReminder);
          if (byId('cancelReminderBtn')) byId('cancelReminderBtn').addEventListener('click', toggleForm.bind(null, showAddFormBtn, reminderFormContainer));
        }

        function setupNotes() {
          const showAddNoteBtn = byId('showAddNoteBtn');
          const noteFormContainer = byId('noteFormContainer');
          if (showAddNoteBtn) showAddNoteBtn.addEventListener('click', toggleForm.bind(null, showAddNoteBtn, noteFormContainer));
          if (byId('saveNoteBtn')) byId('saveNoteBtn').addEventListener('click', saveNote);
          if (byId('cancelNoteBtn')) byId('cancelNoteBtn').addEventListener('click', toggleForm.bind(null, showAddNoteBtn, noteFormContainer));
        }

        function setupBudget() {
          const showAddBudgetBtn = byId('showAddBudgetBtn');
          const budgetFormContainer = byId('budgetFormContainer');
          if (showAddBudgetBtn) showAddBudgetBtn.addEventListener('click', toggleForm.bind(null, showAddBudgetBtn, budgetFormContainer));
          if (byId('saveBudgetBtn')) byId('saveBudgetBtn').addEventListener('click', saveBudget);
          if (byId('cancelBudgetBtn')) byId('cancelBudgetBtn').addEventListener('click', toggleForm.bind(null, showAddBudgetBtn, budgetFormContainer));
        }

        function setupChecklist() {
          const showAddCheckBtn = byId('showAddCheckBtn');
          const checkFormContainer = byId('checkFormContainer');
          if (showAddCheckBtn) showAddCheckBtn.addEventListener('click', toggleForm.bind(null, showAddCheckBtn, checkFormContainer));
          if (byId('saveCheckBtn')) byId('saveCheckBtn').addEventListener('click', saveChecklist);
          if (byId('cancelCheckBtn')) byId('cancelCheckBtn').addEventListener('click', toggleForm.bind(null, showAddCheckBtn, checkFormContainer));
        }

        // ---------- Initial Render Code ----------

        // 1. Set initial UI states from loaded data
        if (appData.darkMode === '1') document.body.classList.add('dark');
        const profileNameEl = byId('profileName'); 
        if (appData.profileName) profileNameEl.textContent = appData.profileName;
        if (appData.profilePhoto) byId('profilePhoto').src = appData.profilePhoto;

        // 2. Initial synchronous render of all data
        setupNavigation();
        setupUI(); 
        setupReminders();
        setupNotes();
        setupBudget();
        setupChecklist();
        setupSettings();
        setupProfile();
        setupCalendar(); 
        setupCalculator(); 

        renderReminders();
        renderNotes();
        renderBudgets();
        renderChecklists();
        renderHistory(); 

        // NEW: Initialize calculator mode
        switchCalculatorMode();


        // 3. Setup notifications
        if (byId('requestPermissionBtn')) {
          byId('requestPermissionBtn').addEventListener('click', requestNotificationPermission);
        }

        if (byId('toggleReminders')) byId('toggleReminders').addEventListener('change', handleCustomNotifToggle.bind(null, 'notifReminders'));
        if (byId('toggleNotes')) byId('toggleNotes').addEventListener('change', handleCustomNotifToggle.bind(null, 'notifNotes'));
        if (byId('toggleChecklist')) byId('toggleChecklist').addEventListener('change', handleCustomNotifToggle.bind(null, 'notifChecklist'));
        if (byId('toggleBudget')) byId('toggleBudget').addEventListener('change', handleCustomNotifToggle.bind(null, 'notifBudget'));

        // Check permissions and fire notifications on load
        if ('Notification' in window) {
          updateBrowserPermissionUI();
          checkNotifications(); // Check once on page load
        }
        // ---------- End Initial Render Code ----------
      })();
    </script>
  </body>
</html>
